!function(){"use strict";class e{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._errorList=e.errorList,this._inputElements=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector)}_showInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorMessageElement.textContent=e.validationMessage,this._errorMessageElement.classList.add(this._errorClass)}_hideInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorMessageElement.textContent="",this._errorMessageElement.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return Array.from(this._inputElements).some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._form.reset(),this._toggleButtonState(),this._inputElements.forEach((e=>{this._hideInputError(e)}))}}class t{constructor(e,t,s,r){this._name=e.name,this._link=e.link,this._id=e._id,this._cardSelector=t,this._data=e,this._handleImageClick=s,this._handleDeleteClick=r,this._cardElement=this._getTemplate()}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0)}_setEventListeners(){this._likeButton=this._cardElement.querySelector(".card__like-button"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteButton()})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick(this._data)}))}_handleLikeButton(){this._likeButton.classList.toggle("card__like-button-active")}_handleDeleteButton(){this._handleDeleteClick(this._id)}getView(){return this._element=this._cardElement,this._cardImageEl=this._element.querySelector(".card__image"),this._element.setAttribute("data-id",this._id),this._element.querySelector(".card__title").textContent=this._name,this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this._setEventListeners(),this._element}}class s{constructor(e){let{modalSelector:t}=e;this._modalElement=document.querySelector(t),this._closeButton=this._modalElement.querySelector(".modal__close"),this._handleEscapeKey=this._handleEscapeKey.bind(this)}open(){this._modalElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscapeKey)}close(){this._modalElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscapeKey)}_handleEscapeKey(e){"Escape"===e.key&&this.close()}_setEventListeners(){this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&this.close()})),this._closeButton.addEventListener("click",(()=>{this.close()}))}}class r extends s{constructor(e,t){super({modalSelector:e}),this._modalForm=this._modalElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputElements=this._modalForm.querySelectorAll(".modal__input")}_getInputValues(){const e={};return this._inputElements.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super._setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}class n{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(e){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse).then((t=>(t.forEach((t=>{const s=t._id;e(s)})),t)))}createCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then((e=>e.ok?e.json():Promise.reject(`Error updating user info: ${e.status}`)))}}new n({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a44aa497-1b5c-4737-a030-aa953cdc7c47","Content-Type":"application/json"}}).getInitialCards().then((e=>{console.log(e)})).catch((e=>{console.log(e)}));const i=document.querySelectorAll(".modal__form"),o=document.querySelector("#profile__edit-button-js"),a=(document.forms["profile-edit-form"],document.querySelector("#profile__add-button-js")),l={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible",errorList:"modal__error"},c=document.querySelector("[name='name']"),d=document.querySelector("[name='about']"),h=new n({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a44aa497-1b5c-4737-a030-aa953cdc7c47","Content-Type":"application/json"}}),m=new class{constructor(e,t){let{items:s,renderer:r}=e;this._renderItems=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._renderItems.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[{name:"Kenai Fjords",link:"https://images.unsplash.com/photo-1547974996-050bf23b6196?q=80&w=2970&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},{name:"Zion National Park",link:"https://images.unsplash.com/photo-1491590324047-588cc8277f59?q=80&w=2970&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},{name:"Mt Rainier National Park",link:"https://images.unsplash.com/photo-1594324587519-20940384fd9c?q=80&w=2970&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},{name:"Bryce Canyon",link:"https://images.unsplash.com/photo-1526008625783-ddfc11a3a962?q=80&w=2970&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},{name:"Glacier National Park",link:"https://images.unsplash.com/photo-1610833783667-f00a448a97f0?q=80&w=2970&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"},{name:"Delicate Arch",link:"https://images.unsplash.com/photo-1535470614242-bf41943a99fd?q=80&w=2968&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"}],renderer:function(e){const t=E(e);m.addItem(t)}},".cards__list");h.getInitialCards(b).then((e=>{m.renderItems(e)})).catch((e=>{console.log(e)}));const u=new r("#profile-edit-modal",(function(e){const t={name:e.name,about:e.about};h.updateUserInfo(t).then((e=>{p.setUserInfo(e),u.close()})).catch((e=>{console.error("Error updating user information:",e)}))}));u.setEventListeners();const _=new r("#add-button-modal",(function(e){const t={name:e.title,link:e.image};h.createCard(t).then((e=>{m.addItem(E(e)),_.close()})).catch((e=>{console.error("Error creating card:",e)}))}));_.setEventListeners();const f=new class extends s{constructor(e){super({modalSelector:e}),this._modalImage=this._modalElement.querySelector(".modal__image"),this._modalImageCaption=this._modalElement.querySelector(".modal__caption")}open(e){this._modalImage.src=e.link,this._modalImage.alt=e.name,this._modalImageCaption.textContent=e.name,super.open()}setEventListeners(){super._setEventListeners(),this._modalImage.addEventListener("submit",(e=>{e.preventDefault()}))}}("#preview-image-modal");f.setEventListeners();const p=new class{constructor(e){let{nameElementSelector:t,aboutElementSelector:s}=e;this._nameElement=document.querySelector(t),this._aboutElement=document.querySelector(s)}getUserInfo(){return this._userInfo={name:this._nameElement.textContent,about:this._aboutElement.textContent},this._userInfo}setUserInfo(e){let{name:t,about:s}=e;this._nameElement.textContent=t,this._aboutElement.textContent=s}}({nameElementSelector:".profile__title",aboutElementSelector:".profile__description"});function E(e){return new t(e,"#card-template",(()=>{f.open(e)}),b).getView()}function b(e){h.deleteCard(e).then((()=>{const t=document.querySelector(`[data-id='${e}']`);t&&t.remove()})).catch((e=>{console.error("Error deleting card:",e)}))}document.addEventListener("DOMContentLoaded",(()=>{h.getUserInfo().then((e=>{c.value=e.name||"",d.value=e.about||"",p.setUserInfo(e)})).catch((e=>{console.error("Error fetching user info:",e)}))})),o.addEventListener("click",(()=>{const e=p.getUserInfo();c.value=e.name.trim(),d.value=e.about.trim(),u.open()})),a.addEventListener("click",(()=>{_.open(),g["add-button-form"].resetValidation()}));const g={};(t=>{t.forEach((t=>{const s=new e(l,t);return s.enableValidation(),g[t.getAttribute("id")]=s,g}))})(i)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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R0FDbkN5RixFQUFXNUMsTUFBUThFLEVBQVNqQixPQUFTLEdBQ3JDOUIsRUFBU2dDLFlBQVllLEVBQVMsSUFFL0IxQyxPQUFPQyxJQUNOSCxRQUFROEIsTUFBTSw0QkFBNkIzQixFQUFJLEdBQy9DLElBa0NORSxFQUFrQmhHLGlCQUFpQixTQUFTLEtBQzFDLE1BQU13SSxFQUFjaEQsRUFBU0YsY0FDN0JjLEVBQVUzQyxNQUFRK0UsRUFBWTVILEtBQUs2SCxPQUNuQ3BDLEVBQVc1QyxNQUFRK0UsRUFBWWxCLE1BQU1tQixPQUVyQ3JCLEVBQWF6RSxNQUFNLElBR3JCc0QsRUFBb0JqRyxpQkFBaUIsU0FBUyxLQUM1QzBILEVBQVUvRSxPQUNWK0YsRUFBZSxtQkFBbUJ0SSxpQkFBaUIsSUE0RXJELE1BQU1zSSxFQUFpQixDQUFDLEVBQ0UzQyxLQUN4QkEsRUFBU2hHLFNBQVM0SSxJQUNoQixNQUFNQyxFQUFnQixJQUFJdkwsRUFBY0UsRUFBVW9MLEdBR2xELE9BRkFDLEVBQWMxSSxtQkFDZHdJLEVBQWVDLEVBQUtFLGFBQWEsT0FBU0QsRUFDbkNGLENBQWMsR0FDckIsRUFHSnhJLENBQWlCNkYsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvdXRpbHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fZm9ybSA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yTGlzdCA9IHNldHRpbmdzLmVycm9yTGlzdDtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuX2lucHV0RWxlbWVudHMpLnNvbWUoXG4gICAgICAoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkXG4gICAgKTtcbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKGRhdGEsIGNhcmRTZWxlY3RvciwgaGFuZGxlSW1hZ2VDbGljaywgaGFuZGxlRGVsZXRlQ2xpY2spIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcbiAgICB0aGlzLl9jYXJkU2VsZWN0b3IgPSBjYXJkU2VsZWN0b3I7XG4gICAgdGhpcy5fZGF0YSA9IGRhdGE7XG4gICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayA9IGhhbmRsZUltYWdlQ2xpY2s7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sgPSBoYW5kbGVEZWxldGVDbGljaztcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gIH1cblxuICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIlxuICAgICk7XG5cbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKCk7XG4gICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b24oKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9kYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVMaWtlQnV0dG9uKCkge1xuICAgIHRoaXMuX2xpa2VCdXR0b24uY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uLWFjdGl2ZVwiKTtcbiAgfVxuXG4gIF9oYW5kbGVEZWxldGVCdXR0b24oKSB7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sodGhpcy5faWQpO1xuICAgIC8vIHRoaXMuX2NhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgIC8vIHRoaXMuX2NhcmRFbGVtZW50ID0gbnVsbDtcbiAgfVxuXG4gIGdldFZpZXcoKSB7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2NhcmRFbGVtZW50O1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICAgIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCB0aGlzLl9pZCk7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcih7IG1vZGFsU2VsZWN0b3IgfSkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XG4gICAgdGhpcy5faGFuZGxlRXNjYXBlS2V5ID0gdGhpcy5faGFuZGxlRXNjYXBlS2V5LmJpbmQodGhpcyk7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZUtleSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NhcGVLZXkpO1xuICB9XG5cbiAgX2hhbmRsZUVzY2FwZUtleShlKSB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX2Nsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX21vZGFsRm9ybSA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMgPSB0aGlzLl9tb2RhbEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIik7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fbW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gb3B0aW9ucy5iYXNlVXJsO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBvcHRpb25zLmhlYWRlcnM7XG4gIH1cblxuICBfY2hlY2tSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKGhhbmRsZURlbGV0ZUNhcmQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxuICAgICAgLnRoZW4oKGNhcmRzKSA9PiB7XG4gICAgICAgIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICAgICAgICBjb25zdCBjYXJkSWQgPSBjYXJkLl9pZDtcbiAgICAgICAgICBoYW5kbGVEZWxldGVDYXJkKGNhcmRJZCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY2FyZHM7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8vIGdldEluaXRpYWxDYXJkcygpIHtcbiAgLy8gICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gIC8vICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAvLyAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIC8vIH1cblxuICBjcmVhdGVDYXJkKGNhcmREYXRhKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShjYXJkRGF0YSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIHVwZGF0ZVVzZXJJbmZvKHVzZXJJbmZvKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkodXNlckluZm8pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgaWYgKHJlcy5vaykge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3IgdXBkYXRpbmcgdXNlciBpbmZvOiAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbn1cblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiYTQ0YWE0OTctMWI1Yy00NzM3LWEwMzAtYWE5NTNjZGM3YzQ3XCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuYXBpXG4gIC5nZXRJbml0aWFsQ2FyZHMoKVxuICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xuICB9KTtcbiIsImV4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIktlbmFpIEZqb3Jkc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1NDc5NzQ5OTYtMDUwYmYyM2I2MTk2P3E9ODAmdz0yOTcwJmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJaaW9uIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNDkxNTkwMzI0MDQ3LTU4OGNjODI3N2Y1OT9xPTgwJnc9Mjk3MCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTXQgUmFpbmllciBOYXRpb25hbCBQYXJrXCIsXG4gICAgbGluazogXCJodHRwczovL2ltYWdlcy51bnNwbGFzaC5jb20vcGhvdG8tMTU5NDMyNDU4NzUxOS0yMDk0MDM4NGZkOWM/cT04MCZ3PTI5NzAmYXV0bz1mb3JtYXQmZml0PWNyb3AmaXhsaWI9cmItNC4wLjMmaXhpZD1NM3d4TWpBM2ZEQjhNSHh3YUc5MGJ5MXdZV2RsZkh4OGZHVnVmREI4Zkh4OGZBJTNEJTNEXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkJyeWNlIENhbnlvblwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1MjYwMDg2MjU3ODMtZGRmYzExYTNhOTYyP3E9ODAmdz0yOTcwJmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJHbGFjaWVyIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNjEwODMzNzgzNjY3LWYwMGE0NDhhOTdmMD9xPTgwJnc9Mjk3MCZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjAuMyZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0RcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiRGVsaWNhdGUgQXJjaFwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9pbWFnZXMudW5zcGxhc2guY29tL3Bob3RvLTE1MzU0NzA2MTQyNDItYmY0MTk0M2E5OWZkP3E9ODAmdz0yOTY4JmF1dG89Zm9ybWF0JmZpdD1jcm9wJml4bGliPXJiLTQuMC4zJml4aWQ9TTN3eE1qQTNmREI4TUh4d2FHOTBieTF3WVdkbGZIeDhmR1Z1ZkRCOGZIeDhmQSUzRCUzRFwiLFxuICB9LFxuXTtcblxuZXhwb3J0IGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fZm9ybVwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGVfX2VkaXQtYnV0dG9uLWpzXCJcbik7XG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJwcm9maWxlLWVkaXQtZm9ybVwiXTtcblxuZXhwb3J0IGNvbnN0IGFkZGNyZWF0ZUNhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlX19hZGQtYnV0dG9uLWpzXCJcbik7XG5cbmV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG4gIGVycm9yTGlzdDogXCJtb2RhbF9fZXJyb3JcIixcbn07XG5cbmV4cG9ydCBjb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J25hbWUnXVwiKTtcbmV4cG9ydCBjb25zdCBhYm91dElucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIltuYW1lPSdhYm91dCddXCIpO1xuIiwiLy8gSU1QT1JUU1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IHtcbiAgZm9ybUxpc3QsXG4gIGluaXRpYWxDYXJkcyxcbiAgc2V0dGluZ3MsXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxuICBhZGRjcmVhdGVDYXJkQnV0dG9uLFxuICBuYW1lSW5wdXQsXG4gIGFib3V0SW5wdXQsXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuLy8gQVBJXG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImE0NGFhNDk3LTFiNWMtNDczNy1hMDMwLWFhOTUzY2RjN2M0N1wiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vIFNFQ1RJT04gQ0xBU1NcblxuY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICBpdGVtczogaW5pdGlhbENhcmRzLFxuICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxuICB9LFxuICBcIi5jYXJkc19fbGlzdFwiXG4pO1xuXG4vLyBjYXJkc1NlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuYXBpXG4gIC5nZXRJbml0aWFsQ2FyZHMoaGFuZGxlRGVsZXRlQ2FyZClcbiAgLnRoZW4oKGluaXRpYWxDYXJkcykgPT4ge1xuICAgIGNhcmRzU2VjdGlvbi5yZW5kZXJJdGVtcyhpbml0aWFsQ2FyZHMpO1xuICB9KVxuICAuY2F0Y2goKGVycikgPT4ge1xuICAgIGNvbnNvbGUubG9nKGVycik7XG4gIH0pO1xuXG4vLyBNT0RBTFNcblxuY29uc3QgcHJvZmlsZU1vZGFsID0gbmV3IE1vZGFsV2l0aEZvcm0oXG4gIFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdFxuKTtcbnByb2ZpbGVNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBjYXJkTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcIiNhZGQtYnV0dG9uLW1vZGFsXCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuY2FyZE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHByZXZpZXdJbWFnZU1vZGFsID0gbmV3IE1vZGFsV2l0aEltYWdlKFwiI3ByZXZpZXctaW1hZ2UtbW9kYWxcIik7XG5wcmV2aWV3SW1hZ2VNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBVU0VSIElORk9cblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBuYW1lRWxlbWVudFNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxuICBhYm91dEVsZW1lbnRTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbn0pO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCAoKSA9PiB7XG4gIGFwaVxuICAgIC5nZXRVc2VySW5mbygpXG4gICAgLnRoZW4oKHVzZXJEYXRhKSA9PiB7XG4gICAgICBuYW1lSW5wdXQudmFsdWUgPSB1c2VyRGF0YS5uYW1lIHx8IFwiXCI7XG4gICAgICBhYm91dElucHV0LnZhbHVlID0gdXNlckRhdGEuYWJvdXQgfHwgXCJcIjtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVzZXJEYXRhKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgdXNlciBpbmZvOlwiLCBlcnIpO1xuICAgIH0pO1xufSk7XG5cbi8vIGFwaVxuLy8gICAuZ2V0VXNlckluZm8oKVxuLy8gICAudGhlbigodXNlckluZm8pID0+IHtcbi8vICAgICBuYW1lSW5wdXQudmFsdWUgPSB1c2VySW5mby5uYW1lIHx8IFwiXCI7XG4vLyAgICAgYWJvdXRJbnB1dC52YWx1ZSA9IHVzZXJJbmZvLmFib3V0IHx8IFwiXCI7XG4vLyAgIH0pXG4vLyAgIC5jYXRjaCgoZXJyKSA9PiB7XG4vLyAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXIgaW5mbzpcIiwgZXJyKTtcbi8vICAgfSk7XG5cbi8vIEZVTkNUSU9OU1xuXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGRhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBuZXcgQ2FyZChcbiAgICBkYXRhLFxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgICAoKSA9PiB7XG4gICAgICBwcmV2aWV3SW1hZ2VNb2RhbC5vcGVuKGRhdGEpO1xuICAgIH0sXG4gICAgaGFuZGxlRGVsZXRlQ2FyZFxuICApO1xuICByZXR1cm4gY2FyZEVsZW1lbnQuZ2V0VmlldygpO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGl0ZW0pIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjcmVhdGVDYXJkKGl0ZW0pO1xuICBjYXJkc1NlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XG59XG5cbi8vIEVWRU5UIExJU1RFTkVSU1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjb25zdCBjdXJyZW50VXNlciA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VyLm5hbWUudHJpbSgpO1xuICBhYm91dElucHV0LnZhbHVlID0gY3VycmVudFVzZXIuYWJvdXQudHJpbSgpO1xuXG4gIHByb2ZpbGVNb2RhbC5vcGVuKCk7XG59KTtcblxuYWRkY3JlYXRlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjYXJkTW9kYWwub3BlbigpO1xuICBmb3JtVmFsaWRhdG9yc1tcImFkZC1idXR0b24tZm9ybVwiXS5yZXNldFZhbGlkYXRpb24oKTtcbn0pO1xuXG4vLyBFVkVOVCBIQU5ETEVSU1xuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdChpbnB1dFZhbHVlcykge1xuICBjb25zdCB1cGRhdGVkVXNlckluZm8gPSB7XG4gICAgbmFtZTogaW5wdXRWYWx1ZXMubmFtZSxcbiAgICBhYm91dDogaW5wdXRWYWx1ZXMuYWJvdXQsXG4gIH07XG5cbiAgYXBpXG4gICAgLnVwZGF0ZVVzZXJJbmZvKHVwZGF0ZWRVc2VySW5mbylcbiAgICAudGhlbigodXBkYXRlZERhdGEpID0+IHtcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHVwZGF0ZWREYXRhKTtcbiAgICAgIHByb2ZpbGVNb2RhbC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyIGluZm9ybWF0aW9uOlwiLCBlcnIpO1xuICAgIH0pO1xufVxuXG4vLyB1c2VySW5mby5zZXRVc2VySW5mbyh1cGRhdGVkVXNlckluZm8pO1xuXG4vLyB1c2VySW5mby5zZXRVc2VySW5mbyh7XG4vLyAgIG5hbWU6IGlucHV0VmFsdWVzLm5hbWUsXG4vLyAgIGFib3V0OiBpbnB1dFZhbHVlcy5hYm91dCxcbi8vIH0pO1xuXG4vLyAgIGFwaVxuLy8gICAgIC51cGRhdGVVc2VySW5mbyh1cGRhdGVkVXNlckluZm8pXG4vLyAgICAgLnRoZW4oKHVwZGF0ZWREYXRhKSA9PiB7XG4vLyAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgaW5mb3JtYXRpb24gdXBkYXRlZCBzdWNjZXNzZnVsbHk6XCIsIHVwZGF0ZWREYXRhKTtcbi8vICAgICB9KVxuLy8gICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4vLyAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdXBkYXRpbmcgdXNlciBpbmZvcm1hdGlvbjpcIiwgZXJyKTtcbi8vICAgICB9KTtcblxuLy8gICBwcm9maWxlTW9kYWwuY2xvc2UoKTtcbi8vIH1cblxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChpbnB1dFZhbHVlcykge1xuICBjb25zdCBuYW1lID0gaW5wdXRWYWx1ZXMudGl0bGU7XG4gIGNvbnN0IGxpbmsgPSBpbnB1dFZhbHVlcy5pbWFnZTtcbiAgY29uc3QgZGF0YSA9IHsgbmFtZSwgbGluayB9O1xuXG4gIGFwaVxuICAgIC5jcmVhdGVDYXJkKGRhdGEpXG4gICAgLnRoZW4oKG5ld0NhcmQpID0+IHtcbiAgICAgIGNhcmRzU2VjdGlvbi5hZGRJdGVtKGNyZWF0ZUNhcmQobmV3Q2FyZCkpO1xuICAgICAgY2FyZE1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIGNhcmQ6XCIsIGVycik7XG4gICAgfSk7XG5cbiAgLy8gY2FyZHNTZWN0aW9uLmFkZEl0ZW0oY3JlYXRlQ2FyZChkYXRhKSk7XG4gIC8vIGNhcmRNb2RhbC5jbG9zZSgpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRJZCkge1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD0nJHtjYXJkSWR9J11gKTtcbiAgICAgIGlmIChjYXJkRWxlbWVudCkge1xuICAgICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZGVsZXRpbmcgY2FyZDpcIiwgZXJyKTtcbiAgICB9KTtcbn1cblxuLy8gVkFMSURBVElPTlxuXG5jb25zdCBmb3JtVmFsaWRhdG9ycyA9IHt9O1xuY29uc3QgZW5hYmxlVmFsaWRhdGlvbiA9IChmb3JtTGlzdCkgPT4ge1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtKSA9PiB7XG4gICAgY29uc3QgZm9ybVZhbGlkYXRvciA9IG5ldyBGb3JtVmFsaWRhdG9yKHNldHRpbmdzLCBmb3JtKTtcbiAgICBmb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbiAgICBmb3JtVmFsaWRhdG9yc1tmb3JtLmdldEF0dHJpYnV0ZShcImlkXCIpXSA9IGZvcm1WYWxpZGF0b3I7XG4gICAgcmV0dXJuIGZvcm1WYWxpZGF0b3JzO1xuICB9KTtcbn07XG5cbmVuYWJsZVZhbGlkYXRpb24oZm9ybUxpc3QpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcmVuZGVySXRlbXMgPSBpdGVtcztcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgdGhpcy5fcmVuZGVySXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRJdGVtKGl0ZW0pIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChpdGVtKTtcbiAgfVxufVxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEltYWdlIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yKSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX21vZGFsSW1hZ2UgPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faW1hZ2VcIik7XG4gICAgdGhpcy5fbW9kYWxJbWFnZUNhcHRpb24gPVxuICAgICAgdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG4gIH1cblxuICBvcGVuKGRhdGEpIHtcbiAgICB0aGlzLl9tb2RhbEltYWdlLnNyYyA9IGRhdGEubGluaztcbiAgICB0aGlzLl9tb2RhbEltYWdlLmFsdCA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9tb2RhbEltYWdlQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBzdXBlci5vcGVuKCk7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9tb2RhbEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIC8vIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFVzZXJJbmZvIHtcbiAgY29uc3RydWN0b3IoeyBuYW1lRWxlbWVudFNlbGVjdG9yLCBhYm91dEVsZW1lbnRTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVFbGVtZW50U2VsZWN0b3IpO1xuICAgIHRoaXMuX2Fib3V0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWJvdXRFbGVtZW50U2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgdGhpcy5fdXNlckluZm8gPSB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudC50ZXh0Q29udGVudCxcbiAgICAgIGFib3V0OiB0aGlzLl9hYm91dEVsZW1lbnQudGV4dENvbnRlbnQsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLl91c2VySW5mbztcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSkge1xuICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB0aGlzLl9hYm91dEVsZW1lbnQudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkZvcm1WYWxpZGF0b3IiLCJjb25zdHJ1Y3RvciIsInNldHRpbmdzIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2Zvcm0iLCJfaW5wdXRTZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJfc3VibWl0QnV0dG9uU2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsIl9pbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5hY3RpdmVCdXR0b25DbGFzcyIsIl9pbnB1dEVycm9yQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJfZXJyb3JDbGFzcyIsImVycm9yQ2xhc3MiLCJfZXJyb3JMaXN0IiwiZXJyb3JMaXN0IiwiX2lucHV0RWxlbWVudHMiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3N1Ym1pdEJ1dHRvbiIsInF1ZXJ5U2VsZWN0b3IiLCJfc2hvd0lucHV0RXJyb3IiLCJpbnB1dEVsZW1lbnQiLCJfZXJyb3JNZXNzYWdlRWxlbWVudCIsImlkIiwiY2xhc3NMaXN0IiwiYWRkIiwidGV4dENvbnRlbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsInJlbW92ZSIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hhc0ludmFsaWRJbnB1dCIsInNvbWUiLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJkaXNhYmxlZCIsIl9zZXRFdmVudExpc3RlbmVycyIsImZvckVhY2giLCJhZGRFdmVudExpc3RlbmVyIiwiZSIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0VmFsaWRhdGlvbiIsInJlc2V0IiwiQ2FyZCIsImRhdGEiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiaGFuZGxlRGVsZXRlQ2xpY2siLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfY2FyZFNlbGVjdG9yIiwiX2RhdGEiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGVDbGljayIsIl9jYXJkRWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsIl9saWtlQnV0dG9uIiwiX2RlbGV0ZUJ1dHRvbiIsIl9oYW5kbGVMaWtlQnV0dG9uIiwiX2hhbmRsZURlbGV0ZUJ1dHRvbiIsIl9jYXJkSW1hZ2VFbCIsInRvZ2dsZSIsImdldFZpZXciLCJfZWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInNyYyIsImFsdCIsIk1vZGFsIiwiX3JlZiIsIm1vZGFsU2VsZWN0b3IiLCJfbW9kYWxFbGVtZW50IiwiX2Nsb3NlQnV0dG9uIiwiX2hhbmRsZUVzY2FwZUtleSIsImJpbmQiLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwidGFyZ2V0IiwiY29udGFpbnMiLCJNb2RhbFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX21vZGFsRm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcGkiLCJvcHRpb25zIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImZldGNoIiwidGhlbiIsImNhcmRzIiwiY2FyZCIsImNhcmRJZCIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImdldFVzZXJJbmZvIiwidXBkYXRlVXNlckluZm8iLCJ1c2VySW5mbyIsImF1dGhvcml6YXRpb24iLCJyZXN1bHQiLCJjb25zb2xlIiwibG9nIiwiY2F0Y2giLCJlcnIiLCJmb3JtTGlzdCIsInByb2ZpbGVFZGl0QnV0dG9uIiwiYWRkY3JlYXRlQ2FyZEJ1dHRvbiIsImZvcm1zIiwiZm9ybVNlbGVjdG9yIiwibmFtZUlucHV0IiwiYWJvdXRJbnB1dCIsImFwaSIsImNhcmRzU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9yZW5kZXJJdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwicHJlcGVuZCIsImNhcmRFbGVtZW50IiwiaW5pdGlhbENhcmRzIiwicHJvZmlsZU1vZGFsIiwidXBkYXRlZFVzZXJJbmZvIiwiYWJvdXQiLCJ1cGRhdGVkRGF0YSIsInNldFVzZXJJbmZvIiwiZXJyb3IiLCJjYXJkTW9kYWwiLCJ0aXRsZSIsImltYWdlIiwibmV3Q2FyZCIsInByZXZpZXdJbWFnZU1vZGFsIiwiX21vZGFsSW1hZ2UiLCJfbW9kYWxJbWFnZUNhcHRpb24iLCJuYW1lRWxlbWVudFNlbGVjdG9yIiwiYWJvdXRFbGVtZW50U2VsZWN0b3IiLCJfbmFtZUVsZW1lbnQiLCJfYWJvdXRFbGVtZW50IiwiX3VzZXJJbmZvIiwiX3JlZjIiLCJ1c2VyRGF0YSIsImN1cnJlbnRVc2VyIiwidHJpbSIsImZvcm1WYWxpZGF0b3JzIiwiZm9ybSIsImZvcm1WYWxpZGF0b3IiLCJnZXRBdHRyaWJ1dGUiXSwic291cmNlUm9vdCI6IiJ9