!function(){"use strict";class e{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._errorList=e.errorList,this._inputElements=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector)}_showInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorMessageElement.textContent=e.validationMessage,this._errorMessageElement.classList.add(this._errorClass)}_hideInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorMessageElement.textContent="",this._errorMessageElement.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return Array.from(this._inputElements).some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._form.reset(),this._toggleButtonState(),this._inputElements.forEach((e=>{this._hideInputError(e)}))}}class t{constructor(e,t,r,s,n,a,i){this._name=e.name,this._link=e.link,this._id=e._id,this._cardSelector=t,this._data=e,this._handleImageClick=r,this._handleDeleteButtonClick=a,this._handleLikeCard=s,this._handleUnlikeCard=n,this._currentUserId=i,this._isLiked=e.isLiked,this._cardElement=this._getTemplate()}_getTemplate(){const e=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0);return this._likeButton=e.querySelector(".card__like-button"),this._deleteButton=e.querySelector(".card__delete-button"),this._cardImageEl=e.querySelector(".card__image"),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteButtonClick(this._id)})),e}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick(this._data)}))}_handleLikeButton(){this._isLiked?this._handleUnlikeCard(this._id).then((()=>{this._isLiked=!1,this.updateLikeStatus()})).catch((e=>{console.error(`Error unliking card: ${e}`)})):this._handleLikeCard(this._id).then((()=>{this._isLiked=!0,this.updateLikeStatus()})).catch((e=>{console.error(`Error liking card: ${e}`)}))}updateLikeStatus(){this._likeButton?this._isLiked?this._likeButton.classList.add("card__like-button-active"):this._likeButton.classList.remove("card__like-button-active"):console.error("Like button not found.")}getView(){return this._element=this._cardElement,this._element.setAttribute("data-id",this._id),this._element.querySelector(".card__title").textContent=this._name,this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this.updateLikeStatus(),this._setEventListeners(),this._element}}class r{constructor(e){let{modalSelector:t}=e;this._modalElement=document.querySelector(t),this._closeButton=this._modalElement.querySelector(".modal__close"),this._handleEscapeKey=this._handleEscapeKey.bind(this)}open(){this._modalElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscapeKey)}close(){this._modalElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscapeKey)}_handleEscapeKey(e){"Escape"===e.key&&this.close()}_setEventListeners(){this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&this.close()})),this._closeButton.addEventListener("click",(()=>{this.close()}))}}class s extends r{constructor(e,t){super({modalSelector:e}),this._modalForm=this._modalElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputElements=this._modalForm.querySelectorAll(".modal__input")}_getInputValues(){const e={};return this._inputElements.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super._setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}const n=document.querySelectorAll(".modal__form"),a=document.querySelector("#profile__edit-button-js"),i=(document.forms["profile-edit-form"],document.querySelector("#profile__add-button-js")),o={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible",errorList:"modal__error"},l=document.querySelector("[name='name']"),d=document.querySelector("[name='about']"),c=document.querySelector(".profile__avatar"),h=document.querySelector("#avatar-edit-modal .modal__button"),u=document.querySelector("#profile-edit-modal .modal__button"),_=document.querySelector("#add-button-modal .modal__button"),m=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}_request(e,t){return fetch(e,t).then(this._checkResponse)}getUserInfoAndCards(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getInitialCards(){return this._request(`${this._baseUrl}/cards`,{headers:this._headers})}createCard(e){return this._request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)})}deleteCard(e){return this._request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}likeCard(e){return this._request(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers})}unlikeCard(e){return this._request(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers})}getUserInfo(){return this._request(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers})}updateUserInfo(e){return this._request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)})}updateUserAvatar(e){return this._request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a44aa497-1b5c-4737-a030-aa953cdc7c47","Content-Type":"application/json"}}),E=new class{constructor(e,t){let{items:r,renderer:s}=e;this._renderItems=r,this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.reverse().forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}getItem(e){return this._renderItems.find((t=>t.id===e))}}({items:[],renderer:function(e){const t=L(e);E.addItem(t)}},".cards__list"),p=new s("#profile-edit-modal",(function(e){u.textContent="Saving...";const t={name:e.name,about:e.about};m.updateUserInfo(t).then((e=>{b.setUserInfo(e),p.close()})).catch((e=>{console.error("Error updating user information:",e)})).finally((()=>{u.textContent="Save"}))}));p.setEventListeners();const v=new s("#add-button-modal",(function(e){_.textContent="Saving...";const t={name:e.title,link:e.image};m.createCard(t).then((e=>{E.addItem(L(e)),v.close()})).catch((e=>{console.error("Error creating card:",e)})).finally((()=>{_.textContent="Create"}))}));v.setEventListeners();const S=new class extends r{constructor(e){super({modalSelector:e}),this._modalImage=this._modalElement.querySelector(".modal__image"),this._modalImageCaption=this._modalElement.querySelector(".modal__caption")}open(e){this._modalImage.src=e.link,this._modalImage.alt=e.name,this._modalImageCaption.textContent=e.name,super.open()}}("#preview-image-modal");S._setEventListeners();const f=new s("#avatar-edit-modal",(function(e){h&&(h.textContent="Saving...");const t=e.avatar;t?m.updateUserAvatar(t).then((e=>{console.log("User avatar updated successfully:",e),b.setUserInfo({avatar:t}),f.close()})).catch((e=>{console.error("Error updating user avatar:",e)})).finally((()=>{h.textContent="Save"})):console.error("Avatar URL is required.")}));f.setEventListeners();const g=new class extends r{constructor(e,t){super({modalSelector:e}),this._handleDeleteCardSubmit=t,this._confirmButton=this._modalElement.querySelector(".modal__button")}setEventListeners(){super._setEventListeners(),this._confirmButton.addEventListener("click",(()=>{const e=this._modalElement.dataset.cardId;this._handleDeleteCardSubmit(e)}))}open(e){this._modalElement.dataset.cardId=e,super.open()}}("#delete-card-modal",(function(e){m.deleteCard(e).then((()=>{const t=document.querySelector(`[data-id='${e}']`);t&&(t.remove(),g.close())})).catch((e=>{console.error("Error deleting card:",e)}))}));g.setEventListeners();const b=new class{constructor(e){let{nameElementSelector:t,aboutElementSelector:r,avatarImageSelector:s}=e;this._nameElement=document.querySelector(t),this._aboutElement=document.querySelector(r),this._avatarImage=document.querySelector(s),this._avatarImage||console.error("Avatar image element not found.")}getUserInfo(){return{name:this._nameElement?.textContent||"",about:this._aboutElement?.textContent||""}}setUserInfo(e){let{name:t,about:r,avatar:s}=e;t&&(this._nameElement.textContent=t),r&&(this._aboutElement.textContent=r),s&&this._avatarImage&&(this._avatarImage.src=s)}getUserId(){return this._userId}}({nameElementSelector:".profile__title",aboutElementSelector:".profile__description",avatarImageSelector:".profile__avatar"});function L(e){return new t(e,"#card-template",(()=>{S.open(e)}),k,I,C,b.getUserId()).getView()}function k(e){return m.likeCard(e).then((()=>{const t=E.getItem(e);t&&t.updateLikeStatus(!0)})).catch((e=>{console.error(`Error liking card: ${e}`)}))}function I(e){return m.unlikeCard(e).then((()=>{const t=E.getItem(e);t&&t.updateLikeStatus(!1)})).catch((e=>{console.error(`Error unliking card: ${e}`)}))}function C(e){g.open(e)}document.addEventListener("DOMContentLoaded",(()=>{m.getUserInfoAndCards().then((e=>{let[t,r]=e;b.setUserInfo(t),E.renderItems(r)})).catch((e=>{console.error("Error fetching user info and cards:",e)}))})),a.addEventListener("click",(()=>{y["profile-edit-form"].resetValidation();const e=b.getUserInfo();l.value=e.name.trim(),d.value=e.about.trim(),p.open()})),i.addEventListener("click",(()=>{v.open(),y["add-button-form"].resetValidation()})),c.addEventListener("click",(()=>{f.open(),y["avatar-edit-form"].resetValidation()}));const y={};(t=>{t.forEach((t=>{const r=new e(o,t);return r.enableValidation(),y[t.getAttribute("id")]=r,y}))})(n)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixLQUFLc0QsRUFDdkIsQ0F2RkEvRSxTQUFTL0IsaUJBQWlCLG9CQUFvQixLQUM1Q21GLEVBQ0dnQixzQkFDQTdELE1BQUtZLElBQThCLElBQTVCb0gsRUFBVUMsR0FBYXJILEVBQzdCZ0UsRUFBU3lCLFlBQVkyQixHQUNyQi9DLEVBQWFPLFlBQVl5QyxFQUFhLElBRXZDL0gsT0FBT0MsSUFDTkMsUUFBUUMsTUFBTSxzQ0FBdUNGLEVBQUksR0FDekQsSUE0Qk5nQyxFQUFrQnpFLGlCQUFpQixTQUFTLEtBQzFDd0ssRUFBZSxxQkFBcUJwSyxrQkFDcEMsTUFBTXFLLEVBQWN2RCxFQUFTYixjQUM3QnhCLEVBQVVQLE1BQVFtRyxFQUFZMUosS0FBSzJKLE9BQ25DNUYsRUFBV1IsTUFBUW1HLEVBQVloQyxNQUFNaUMsT0FDckNuQyxFQUFhL0UsTUFBTSxJQUdyQmtCLEVBQW9CMUUsaUJBQWlCLFNBQVMsS0FDNUM2SSxFQUFVckYsT0FDVmdILEVBQWUsbUJBQW1CcEssaUJBQWlCLElBR3JEMkUsRUFBWS9FLGlCQUFpQixTQUFTLEtBQ3BDb0osRUFBZ0I1RixPQUNoQmdILEVBQWUsb0JBQW9CcEssaUJBQWlCLElBeUh0RCxNQUFNb0ssRUFBaUIsQ0FBQyxFQUNFaEcsS0FDeEJBLEVBQVN6RSxTQUFTNEssSUFDaEIsTUFBTUMsRUFBZ0IsSUFBSXZOLEVBQWNFLEVBQVVvTixHQUdsRCxPQUZBQyxFQUFjMUssbUJBQ2RzSyxFQUFlRyxFQUFLRSxhQUFhLE9BQVNELEVBQ25DSixDQUFjLEdBQ3JCLEVBR0p0SyxDQUFpQnNFLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvQ2FyZC5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWwuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL01vZGFsV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Nb2RhbFdpdGhJbWFnZS5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWxXaXRoQ29uZmlybWF0aW9uLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Vc2VySW5mby5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBGb3JtVmFsaWRhdG9yIHtcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5fZm9ybSA9IGZvcm1FbGVtZW50O1xuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBzZXR0aW5ncy5pbnB1dFNlbGVjdG9yO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XG4gICAgdGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyA9IHNldHRpbmdzLmluYWN0aXZlQnV0dG9uQ2xhc3M7XG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gc2V0dGluZ3MuaW5wdXRFcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yTGlzdCA9IHNldHRpbmdzLmVycm9yTGlzdDtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgfVxuXG4gIF9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsZW1lbnQpIHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuX2lucHV0RWxlbWVudHMpLnNvbWUoXG4gICAgICAoaW5wdXRFbGVtZW50KSA9PiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkXG4gICAgKTtcbiAgfVxuXG4gIF90b2dnbGVCdXR0b25TdGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KCkpIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QuYWRkKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIGlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKGUpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgfSk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLnJlc2V0KCk7XG4gICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGRhdGEsXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgaGFuZGxlTGlrZUNhcmQsXG4gICAgaGFuZGxlVW5saWtlQ2FyZCxcbiAgICBoYW5kbGVEZWxldGVCdXR0b25DbGljayxcbiAgICBjdXJyZW50VXNlcklkXG4gICkge1xuICAgIHRoaXMuX25hbWUgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcbiAgICB0aGlzLl9pZCA9IGRhdGEuX2lkO1xuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b25DbGljayA9IGhhbmRsZURlbGV0ZUJ1dHRvbkNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VDYXJkID0gaGFuZGxlTGlrZUNhcmQ7XG4gICAgdGhpcy5faGFuZGxlVW5saWtlQ2FyZCA9IGhhbmRsZVVubGlrZUNhcmQ7XG4gICAgdGhpcy5fY3VycmVudFVzZXJJZCA9IGN1cnJlbnRVc2VySWQ7XG4gICAgdGhpcy5faXNMaWtlZCA9IGRhdGEuaXNMaWtlZDtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XG4gIH1cblxuICBfZ2V0VGVtcGxhdGUoKSB7XG4gICAgY29uc3QgdGVtcGxhdGUgPSBkb2N1bWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICAgIHRoaXMuX2xpa2VCdXR0b24gPSB0ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAgIHRoaXMuX2RlbGV0ZUJ1dHRvbiA9IHRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbCA9IHRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG5cbiAgICB0aGlzLl9kZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUJ1dHRvbkNsaWNrKHRoaXMuX2lkKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKCk7XG4gICAgfSk7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sodGhpcy5fZGF0YSk7XG4gICAgfSk7XG4gIH1cblxuICBfaGFuZGxlTGlrZUJ1dHRvbigpIHtcbiAgICBpZiAodGhpcy5faXNMaWtlZCkge1xuICAgICAgdGhpcy5faGFuZGxlVW5saWtlQ2FyZCh0aGlzLl9pZClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHRoaXMuX2lzTGlrZWQgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnVwZGF0ZUxpa2VTdGF0dXMoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciB1bmxpa2luZyBjYXJkOiAke2Vycn1gKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VDYXJkKHRoaXMuX2lkKVxuICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5faXNMaWtlZCA9IHRydWU7XG4gICAgICAgICAgdGhpcy51cGRhdGVMaWtlU3RhdHVzKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgbGlraW5nIGNhcmQ6ICR7ZXJyfWApO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICB1cGRhdGVMaWtlU3RhdHVzKCkge1xuICAgIGlmICh0aGlzLl9saWtlQnV0dG9uKSB7XG4gICAgICBpZiAodGhpcy5faXNMaWtlZCkge1xuICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMaWtlIGJ1dHRvbiBub3QgZm91bmQuXCIpO1xuICAgIH1cbiAgfVxuXG4gIGdldFZpZXcoKSB7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2NhcmRFbGVtZW50O1xuICAgIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1pZFwiLCB0aGlzLl9pZCk7XG4gICAgdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpLnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsLmFsdCA9IHRoaXMuX25hbWU7XG4gICAgdGhpcy51cGRhdGVMaWtlU3RhdHVzKCk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50O1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKHsgbW9kYWxTZWxlY3RvciB9KSB7XG4gICAgdGhpcy5fbW9kYWxFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihtb2RhbFNlbGVjdG9yKTtcbiAgICB0aGlzLl9jbG9zZUJ1dHRvbiA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZVwiKTtcbiAgICB0aGlzLl9oYW5kbGVFc2NhcGVLZXkgPSB0aGlzLl9oYW5kbGVFc2NhcGVLZXkuYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjYXBlS2V5KTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZUtleSk7XG4gIH1cblxuICBfaGFuZGxlRXNjYXBlS2V5KGUpIHtcbiAgICBpZiAoZS5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5fbW9kYWxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsV2l0aEZvcm0gZXh0ZW5kcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcbiAgICBzdXBlcih7IG1vZGFsU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fbW9kYWxGb3JtID0gdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50cyA9IHRoaXMuX21vZGFsRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19pbnB1dFwiKTtcbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHt9O1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0VmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gaW5wdXRWYWx1ZXM7XG4gIH1cblxuICBzZXRFdmVudExpc3RlbmVycygpIHtcbiAgICBzdXBlci5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9tb2RhbEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9fZm9ybVwiKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZV9fZWRpdC1idXR0b24tanNcIlxuKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVFZGl0Rm9ybSA9IGRvY3VtZW50LmZvcm1zW1wicHJvZmlsZS1lZGl0LWZvcm1cIl07XG5cbmV4cG9ydCBjb25zdCBhZGRjcmVhdGVDYXJkQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZV9fYWRkLWJ1dHRvbi1qc1wiXG4pO1xuXG5leHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fYnV0dG9uXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX2J1dHRvbl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JfdmlzaWJsZVwiLFxuICBlcnJvckxpc3Q6IFwibW9kYWxfX2Vycm9yXCIsXG59O1xuXG5leHBvcnQgY29uc3QgbmFtZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIltuYW1lPSduYW1lJ11cIik7XG5leHBvcnQgY29uc3QgYWJvdXRJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZT0nYWJvdXQnXVwiKTtcblxuZXhwb3J0IGNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5cbmV4cG9ydCBjb25zdCBhdmF0YXJTYXZlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjYXZhdGFyLWVkaXQtbW9kYWwgLm1vZGFsX19idXR0b25cIlxuKTtcblxuZXhwb3J0IGNvbnN0IHByb2ZpbGVTYXZlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsIC5tb2RhbF9fYnV0dG9uXCJcbik7XG5cbmV4cG9ydCBjb25zdCBhZGRDYXJkU2F2ZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI2FkZC1idXR0b24tbW9kYWwgLm1vZGFsX19idXR0b25cIlxuKTtcbiIsIi8vIElNUE9SVFNcbmltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQgRm9ybVZhbGlkYXRvciBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzXCI7XG5pbXBvcnQgU2VjdGlvbiBmcm9tIFwiLi4vY29tcG9uZW50cy9TZWN0aW9uLmpzXCI7XG5pbXBvcnQgQ2FyZCBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkLmpzXCI7XG5pbXBvcnQgTW9kYWxXaXRoSW1hZ2UgZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoSW1hZ2UuanNcIjtcbmltcG9ydCBNb2RhbFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL01vZGFsV2l0aEZvcm0uanNcIjtcbmltcG9ydCBNb2RhbFdpdGhDb25maXJtYXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoQ29uZmlybWF0aW9uLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG5pbXBvcnQge1xuICBmb3JtTGlzdCxcbiAgc2V0dGluZ3MsXG4gIHByb2ZpbGVFZGl0QnV0dG9uLFxuICBhZGRjcmVhdGVDYXJkQnV0dG9uLFxuICBuYW1lSW5wdXQsXG4gIGFib3V0SW5wdXQsXG4gIGF2YXRhckltYWdlLFxuICBhdmF0YXJTYXZlQnV0dG9uLFxuICBwcm9maWxlU2F2ZUJ1dHRvbixcbiAgYWRkQ2FyZFNhdmVCdXR0b24sXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuLy8gQVBJXG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImE0NGFhNDk3LTFiNWMtNDczNy1hMDMwLWFhOTUzY2RjN2M0N1wiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vIFNFQ1RJT04gQ0xBU1NcblxuY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICBpdGVtczogW10sXG4gICAgcmVuZGVyZXI6IHJlbmRlckNhcmQsXG4gIH0sXG4gIFwiLmNhcmRzX19saXN0XCJcbik7XG5cbi8vIE1PREFMU1xuXG5jb25zdCBwcm9maWxlTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXG4gIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0XG4pO1xucHJvZmlsZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGNhcmRNb2RhbCA9IG5ldyBNb2RhbFdpdGhGb3JtKFwiI2FkZC1idXR0b24tbW9kYWxcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5jYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgcHJldmlld0ltYWdlTW9kYWwgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoXCIjcHJldmlldy1pbWFnZS1tb2RhbFwiKTtcbnByZXZpZXdJbWFnZU1vZGFsLl9zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBhdmF0YXJFZGl0TW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcbiAgXCIjYXZhdGFyLWVkaXQtbW9kYWxcIixcbiAgaGFuZGxlQXZhdGFySW1hZ2VTdWJtaXRcbik7XG5hdmF0YXJFZGl0TW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgZGVsZXRlQ2FyZE1vZGFsID0gbmV3IE1vZGFsV2l0aENvbmZpcm1hdGlvbihcbiAgXCIjZGVsZXRlLWNhcmQtbW9kYWxcIixcbiAgaGFuZGxlRGVsZXRlQ2FyZFxuKTtcbmRlbGV0ZUNhcmRNb2RhbC5zZXRFdmVudExpc3RlbmVycygpO1xuXG4vLyBVU0VSIElORk9cblxuY29uc3QgdXNlckluZm8gPSBuZXcgVXNlckluZm8oe1xuICBuYW1lRWxlbWVudFNlbGVjdG9yOiBcIi5wcm9maWxlX190aXRsZVwiLFxuICBhYm91dEVsZW1lbnRTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIixcbiAgYXZhdGFySW1hZ2VTZWxlY3RvcjogXCIucHJvZmlsZV9fYXZhdGFyXCIsXG59KTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICBhcGlcbiAgICAuZ2V0VXNlckluZm9BbmRDYXJkcygpXG4gICAgLnRoZW4oKFt1c2VyRGF0YSwgaW5pdGlhbENhcmRzXSkgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXNlckRhdGEpO1xuICAgICAgY2FyZHNTZWN0aW9uLnJlbmRlckl0ZW1zKGluaXRpYWxDYXJkcyk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIHVzZXIgaW5mbyBhbmQgY2FyZHM6XCIsIGVycik7XG4gICAgfSk7XG59KTtcblxuLy8gRlVOQ1RJT05TXG5cbmZ1bmN0aW9uIGNyZWF0ZUNhcmQoZGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IG5ldyBDYXJkKFxuICAgIGRhdGEsXG4gICAgXCIjY2FyZC10ZW1wbGF0ZVwiLFxuICAgICgpID0+IHtcbiAgICAgIHByZXZpZXdJbWFnZU1vZGFsLm9wZW4oZGF0YSk7XG4gICAgfSxcbiAgICBoYW5kbGVMaWtlQ2FyZCxcbiAgICBoYW5kbGVVbmxpa2VDYXJkLFxuICAgIGhhbmRsZURlbGV0ZUJ1dHRvbkNsaWNrLFxuICAgIHVzZXJJbmZvLmdldFVzZXJJZCgpXG4gICk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50LmdldFZpZXcoKTtcbn1cblxuZnVuY3Rpb24gcmVuZGVyQ2FyZChjYXJkRGF0YSkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xuICBjYXJkc1NlY3Rpb24uYWRkSXRlbShjYXJkRWxlbWVudCk7XG59XG5cbi8vIEVWRU5UIExJU1RFTkVSU1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBmb3JtVmFsaWRhdG9yc1tcInByb2ZpbGUtZWRpdC1mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xuICBjb25zdCBjdXJyZW50VXNlciA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VyLm5hbWUudHJpbSgpO1xuICBhYm91dElucHV0LnZhbHVlID0gY3VycmVudFVzZXIuYWJvdXQudHJpbSgpO1xuICBwcm9maWxlTW9kYWwub3BlbigpO1xufSk7XG5cbmFkZGNyZWF0ZUNhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2FyZE1vZGFsLm9wZW4oKTtcbiAgZm9ybVZhbGlkYXRvcnNbXCJhZGQtYnV0dG9uLWZvcm1cIl0ucmVzZXRWYWxpZGF0aW9uKCk7XG59KTtcblxuYXZhdGFySW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgYXZhdGFyRWRpdE1vZGFsLm9wZW4oKTtcbiAgZm9ybVZhbGlkYXRvcnNbXCJhdmF0YXItZWRpdC1mb3JtXCJdLnJlc2V0VmFsaWRhdGlvbigpO1xufSk7XG5cbi8vIEVWRU5UIEhBTkRMRVJTXG5cbmZ1bmN0aW9uIGhhbmRsZUxpa2VDYXJkKGNhcmRJZCkge1xuICByZXR1cm4gYXBpXG4gICAgLmxpa2VDYXJkKGNhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zdCBjYXJkID0gY2FyZHNTZWN0aW9uLmdldEl0ZW0oY2FyZElkKTtcbiAgICAgIGlmIChjYXJkKSB7XG4gICAgICAgIGNhcmQudXBkYXRlTGlrZVN0YXR1cyh0cnVlKTtcbiAgICAgIH1cbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBsaWtpbmcgY2FyZDogJHtlcnJ9YCk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVVubGlrZUNhcmQoY2FyZElkKSB7XG4gIHJldHVybiBhcGlcbiAgICAudW5saWtlQ2FyZChjYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY29uc3QgY2FyZCA9IGNhcmRzU2VjdGlvbi5nZXRJdGVtKGNhcmRJZCk7XG4gICAgICBpZiAoY2FyZCkge1xuICAgICAgICBjYXJkLnVwZGF0ZUxpa2VTdGF0dXMoZmFsc2UpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHVubGlraW5nIGNhcmQ6ICR7ZXJyfWApO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVCdXR0b25DbGljayhjYXJkSWQpIHtcbiAgZGVsZXRlQ2FyZE1vZGFsLm9wZW4oY2FyZElkKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUHJvZmlsZUVkaXRTdWJtaXQoaW5wdXRWYWx1ZXMpIHtcbiAgcHJvZmlsZVNhdmVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmluZy4uLlwiO1xuXG4gIGNvbnN0IHVwZGF0ZWRVc2VySW5mbyA9IHtcbiAgICBuYW1lOiBpbnB1dFZhbHVlcy5uYW1lLFxuICAgIGFib3V0OiBpbnB1dFZhbHVlcy5hYm91dCxcbiAgfTtcblxuICBhcGlcbiAgICAudXBkYXRlVXNlckluZm8odXBkYXRlZFVzZXJJbmZvKVxuICAgIC50aGVuKCh1cGRhdGVkRGF0YSkgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXBkYXRlZERhdGEpO1xuICAgICAgcHJvZmlsZU1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHVzZXIgaW5mb3JtYXRpb246XCIsIGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBwcm9maWxlU2F2ZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkU3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGFkZENhcmRTYXZlQnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcbiAgY29uc3QgbmFtZSA9IGlucHV0VmFsdWVzLnRpdGxlO1xuICBjb25zdCBsaW5rID0gaW5wdXRWYWx1ZXMuaW1hZ2U7XG4gIGNvbnN0IGRhdGEgPSB7IG5hbWUsIGxpbmsgfTtcblxuICBhcGlcbiAgICAuY3JlYXRlQ2FyZChkYXRhKVxuICAgIC50aGVuKChuZXdDYXJkKSA9PiB7XG4gICAgICBjYXJkc1NlY3Rpb24uYWRkSXRlbShjcmVhdGVDYXJkKG5ld0NhcmQpKTtcbiAgICAgIGNhcmRNb2RhbC5jbG9zZSgpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjcmVhdGluZyBjYXJkOlwiLCBlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYWRkQ2FyZFNhdmVCdXR0b24udGV4dENvbnRlbnQgPSBcIkNyZWF0ZVwiO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmRJZCkge1xuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChjYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBbZGF0YS1pZD0nJHtjYXJkSWR9J11gKTtcbiAgICAgIGlmIChjYXJkRWxlbWVudCkge1xuICAgICAgICBjYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgZGVsZXRlQ2FyZE1vZGFsLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGRlbGV0aW5nIGNhcmQ6XCIsIGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhckltYWdlU3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGlmIChhdmF0YXJTYXZlQnV0dG9uKSB7XG4gICAgYXZhdGFyU2F2ZUJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gIH1cblxuICBjb25zdCBhdmF0YXJVcmwgPSBpbnB1dFZhbHVlcy5hdmF0YXI7XG4gIGlmIChhdmF0YXJVcmwpIHtcbiAgICBhcGlcbiAgICAgIC51cGRhdGVVc2VyQXZhdGFyKGF2YXRhclVybClcbiAgICAgIC50aGVuKCh1cGRhdGVkRGF0YSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgYXZhdGFyIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5OlwiLCB1cGRhdGVkRGF0YSk7XG4gICAgICAgIHVzZXJJbmZvLnNldFVzZXJJbmZvKHsgYXZhdGFyOiBhdmF0YXJVcmwgfSk7XG4gICAgICAgIGF2YXRhckVkaXRNb2RhbC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyIGF2YXRhcjpcIiwgZXJyKTtcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICAgIGF2YXRhclNhdmVCdXR0b24udGV4dENvbnRlbnQgPSBcIlNhdmVcIjtcbiAgICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJBdmF0YXIgVVJMIGlzIHJlcXVpcmVkLlwiKTtcbiAgfVxufVxuXG4vLyBWQUxJREFUSU9OXG5cbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGZvcm1MaXN0KSA9PiB7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm0pID0+IHtcbiAgICBjb25zdCBmb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGZvcm0pO1xuICAgIGZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIildID0gZm9ybVZhbGlkYXRvcjtcbiAgICByZXR1cm4gZm9ybVZhbGlkYXRvcnM7XG4gIH0pO1xufTtcblxuZW5hYmxlVmFsaWRhdGlvbihmb3JtTGlzdCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xuICB9XG5cbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIF9yZXF1ZXN0KHVybCwgb3B0aW9ucykge1xuICAgIHJldHVybiBmZXRjaCh1cmwsIG9wdGlvbnMpLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRVc2VySW5mb0FuZENhcmRzKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VySW5mbygpLCB0aGlzLmdldEluaXRpYWxDYXJkcygpXSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlQ2FyZChjYXJkRGF0YSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShjYXJkRGF0YSksXG4gICAgfSk7XG4gIH1cblxuICBkZWxldGVDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBsaWtlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgdW5saWtlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgdXBkYXRlVXNlckluZm8odXNlckluZm8pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHVzZXJJbmZvKSxcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZVVzZXJBdmF0YXIoYXZhdGFyVXJsKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXI6IGF2YXRhclVybCB9KSxcbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5fcmVuZGVySXRlbXMgPSBpdGVtcztcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoaXRlbXMpIHtcbiAgICBpdGVtcy5yZXZlcnNlKCkuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIoaXRlbSk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRJdGVtKGl0ZW0pIHtcbiAgICB0aGlzLl9jb250YWluZXIucHJlcGVuZChpdGVtKTtcbiAgfVxuXG4gIGdldEl0ZW0oaXRlbUlkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlbmRlckl0ZW1zLmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQgPT09IGl0ZW1JZCk7XG4gIH1cbn1cbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhJbWFnZSBleHRlbmRzIE1vZGFsIHtcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgbW9kYWxTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9tb2RhbEltYWdlID0gdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuICAgIHRoaXMuX21vZGFsSW1hZ2VDYXB0aW9uID1cbiAgICAgIHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuICB9XG5cbiAgb3BlbihkYXRhKSB7XG4gICAgdGhpcy5fbW9kYWxJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5fbW9kYWxJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG4gICAgdGhpcy5fbW9kYWxJbWFnZUNhcHRpb24udGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gICAgc3VwZXIub3BlbigpO1xuICB9XG59XG4iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoQ29uZmlybWF0aW9uIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVEZWxldGVDYXJkU3VibWl0KSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmRTdWJtaXQgPSBoYW5kbGVEZWxldGVDYXJkU3VibWl0O1xuICAgIHRoaXMuX2NvbmZpcm1CdXR0b24gPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fYnV0dG9uXCIpO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fY29uZmlybUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY2FyZElkID0gdGhpcy5fbW9kYWxFbGVtZW50LmRhdGFzZXQuY2FyZElkO1xuICAgICAgdGhpcy5faGFuZGxlRGVsZXRlQ2FyZFN1Ym1pdChjYXJkSWQpO1xuICAgIH0pO1xuICB9XG5cbiAgb3BlbihjYXJkSWRUb0RlbGV0ZSkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5kYXRhc2V0LmNhcmRJZCA9IGNhcmRJZFRvRGVsZXRlO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7XG4gICAgbmFtZUVsZW1lbnRTZWxlY3RvcixcbiAgICBhYm91dEVsZW1lbnRTZWxlY3RvcixcbiAgICBhdmF0YXJJbWFnZVNlbGVjdG9yLFxuICB9KSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKG5hbWVFbGVtZW50U2VsZWN0b3IpO1xuICAgIHRoaXMuX2Fib3V0RWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWJvdXRFbGVtZW50U2VsZWN0b3IpO1xuICAgIHRoaXMuX2F2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhdmF0YXJJbWFnZVNlbGVjdG9yKTtcblxuICAgIGlmICghdGhpcy5fYXZhdGFySW1hZ2UpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdmF0YXIgaW1hZ2UgZWxlbWVudCBub3QgZm91bmQuXCIpO1xuICAgIH1cbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lRWxlbWVudD8udGV4dENvbnRlbnQgfHwgXCJcIixcbiAgICAgIGFib3V0OiB0aGlzLl9hYm91dEVsZW1lbnQ/LnRleHRDb250ZW50IHx8IFwiXCIsXG4gICAgfTtcbiAgfVxuXG4gIHNldFVzZXJJbmZvKHsgbmFtZSwgYWJvdXQsIGF2YXRhciB9KSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gbmFtZTtcbiAgICB9XG4gICAgaWYgKGFib3V0KSB7XG4gICAgICB0aGlzLl9hYm91dEVsZW1lbnQudGV4dENvbnRlbnQgPSBhYm91dDtcbiAgICB9XG4gICAgaWYgKGF2YXRhciAmJiB0aGlzLl9hdmF0YXJJbWFnZSkge1xuICAgICAgdGhpcy5fYXZhdGFySW1hZ2Uuc3JjID0gYXZhdGFyO1xuICAgIH1cbiAgfVxuXG4gIGdldFVzZXJJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fdXNlcklkO1xuICB9XG59XG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybSIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9lcnJvckxpc3QiLCJlcnJvckxpc3QiLCJfaW5wdXRFbGVtZW50cyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwicXVlcnlTZWxlY3RvciIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsIl9lcnJvck1lc3NhZ2VFbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0Iiwic29tZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImRpc2FibGVkIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwicmVzZXQiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVMaWtlQ2FyZCIsImhhbmRsZVVubGlrZUNhcmQiLCJoYW5kbGVEZWxldGVCdXR0b25DbGljayIsImN1cnJlbnRVc2VySWQiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfY2FyZFNlbGVjdG9yIiwiX2RhdGEiLCJfaGFuZGxlSW1hZ2VDbGljayIsIl9oYW5kbGVEZWxldGVCdXR0b25DbGljayIsIl9oYW5kbGVMaWtlQ2FyZCIsIl9oYW5kbGVVbmxpa2VDYXJkIiwiX2N1cnJlbnRVc2VySWQiLCJfaXNMaWtlZCIsImlzTGlrZWQiLCJfY2FyZEVsZW1lbnQiLCJfZ2V0VGVtcGxhdGUiLCJ0ZW1wbGF0ZSIsImRvY3VtZW50IiwiY29udGVudCIsImNsb25lTm9kZSIsIl9saWtlQnV0dG9uIiwiX2RlbGV0ZUJ1dHRvbiIsIl9jYXJkSW1hZ2VFbCIsIl9oYW5kbGVMaWtlQnV0dG9uIiwidGhlbiIsInVwZGF0ZUxpa2VTdGF0dXMiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImdldFZpZXciLCJfZWxlbWVudCIsInNldEF0dHJpYnV0ZSIsInNyYyIsImFsdCIsIk1vZGFsIiwiX3JlZiIsIm1vZGFsU2VsZWN0b3IiLCJfbW9kYWxFbGVtZW50IiwiX2Nsb3NlQnV0dG9uIiwiX2hhbmRsZUVzY2FwZUtleSIsImJpbmQiLCJvcGVuIiwiY2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwia2V5IiwidGFyZ2V0IiwiY29udGFpbnMiLCJNb2RhbFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX21vZGFsRm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX2dldElucHV0VmFsdWVzIiwiaW5wdXRWYWx1ZXMiLCJpbnB1dCIsInZhbHVlIiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJmb3JtTGlzdCIsInByb2ZpbGVFZGl0QnV0dG9uIiwiYWRkY3JlYXRlQ2FyZEJ1dHRvbiIsImZvcm1zIiwiZm9ybVNlbGVjdG9yIiwibmFtZUlucHV0IiwiYWJvdXRJbnB1dCIsImF2YXRhckltYWdlIiwiYXZhdGFyU2F2ZUJ1dHRvbiIsInByb2ZpbGVTYXZlQnV0dG9uIiwiYWRkQ2FyZFNhdmVCdXR0b24iLCJhcGkiLCJvcHRpb25zIiwiX2Jhc2VVcmwiLCJiYXNlVXJsIiwiX2hlYWRlcnMiLCJoZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiX3JlcXVlc3QiLCJ1cmwiLCJmZXRjaCIsImdldFVzZXJJbmZvQW5kQ2FyZHMiLCJhbGwiLCJnZXRVc2VySW5mbyIsImdldEluaXRpYWxDYXJkcyIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsInVwZGF0ZVVzZXJJbmZvIiwidXNlckluZm8iLCJ1cGRhdGVVc2VyQXZhdGFyIiwiYXZhdGFyVXJsIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9yZW5kZXJJdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsInJldmVyc2UiLCJpdGVtIiwiYWRkSXRlbSIsInByZXBlbmQiLCJnZXRJdGVtIiwiaXRlbUlkIiwiZmluZCIsImNhcmRFbGVtZW50IiwicHJvZmlsZU1vZGFsIiwidXBkYXRlZFVzZXJJbmZvIiwiYWJvdXQiLCJ1cGRhdGVkRGF0YSIsInNldFVzZXJJbmZvIiwiZmluYWxseSIsImNhcmRNb2RhbCIsInRpdGxlIiwiaW1hZ2UiLCJuZXdDYXJkIiwicHJldmlld0ltYWdlTW9kYWwiLCJfbW9kYWxJbWFnZSIsIl9tb2RhbEltYWdlQ2FwdGlvbiIsImF2YXRhckVkaXRNb2RhbCIsImxvZyIsImRlbGV0ZUNhcmRNb2RhbCIsImhhbmRsZURlbGV0ZUNhcmRTdWJtaXQiLCJfaGFuZGxlRGVsZXRlQ2FyZFN1Ym1pdCIsIl9jb25maXJtQnV0dG9uIiwiZGF0YXNldCIsImNhcmRJZFRvRGVsZXRlIiwibmFtZUVsZW1lbnRTZWxlY3RvciIsImFib3V0RWxlbWVudFNlbGVjdG9yIiwiYXZhdGFySW1hZ2VTZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9hYm91dEVsZW1lbnQiLCJfYXZhdGFySW1hZ2UiLCJfcmVmMiIsImdldFVzZXJJZCIsIl91c2VySWQiLCJjYXJkIiwidXNlckRhdGEiLCJpbml0aWFsQ2FyZHMiLCJmb3JtVmFsaWRhdG9ycyIsImN1cnJlbnRVc2VyIiwidHJpbSIsImZvcm0iLCJmb3JtVmFsaWRhdG9yIiwiZ2V0QXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==