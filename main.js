!function(){"use strict";class e{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._errorList=e.errorList,this._inputElements=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(this._submitButtonSelector)}_showInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.add(this._inputErrorClass),this._errorMessageElement.textContent=e.validationMessage,this._errorMessageElement.classList.add(this._errorClass)}_hideInputError(e){this._errorMessageElement=this._form.querySelector(`#${e.id}-error`),e.classList.remove(this._inputErrorClass),this._errorMessageElement.textContent="",this._errorMessageElement.classList.remove(this._errorClass)}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}_hasInvalidInput(){return Array.from(this._inputElements).some((e=>!e.validity.valid))}_toggleButtonState(){this._hasInvalidInput()?(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0):(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1)}_setEventListeners(){this._inputElements.forEach((e=>{e.addEventListener("input",(t=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}resetValidation(){this._form.reset(),this._toggleButtonState(),this._inputElements.forEach((e=>{this._hideInputError(e)}))}}class t{constructor(e,t,s,r,n,i,o){this._name=e.name,this._link=e.link,this._id=e._id,this._likes=e.likes||[],this._cardSelector=t,this._data=e,this._handleImageClick=s,this._handleDeleteClick=r,this._handleLikeCard=n,this._handleUnlikeCard=i,this._currentUserId=o,this._cardElement=this._getTemplate()}_getTemplate(){const e=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0);return this._likeButton=e.querySelector(".card__like-button"),this._deleteButton=e.querySelector(".card__delete-button"),this._likeCountElement=e.querySelector(".card__like-count"),e}_setEventListeners(){this._likeButton.addEventListener("click",(()=>{this._handleLikeButton()})),this._deleteButton.addEventListener("click",(()=>{this._handleDeleteButton()})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick(this._data)}))}_handleLikeButton(){this._isLiked()?this._handleUnlikeCard(this._id).then((e=>{this._likes=e.likes,this._updateLikeStatus()})).catch((e=>{console.error(`Error unliking card: ${e}`)})):this._handleLikeCard(this._id).then((e=>{this._likes=e.likes,this._updateLikeStatus()})).catch((e=>{console.error(`Error liking card: ${e}`)}))}_isLiked(){return this._likes.some((e=>e._id===this._currentUserId))}_updateLikeStatus(){const e=this._cardElement.querySelector(".card__like-count");e&&(e.textContent=this._likes.length),this._likeButton?this._isLiked()?this._likeButton.classList.add("card__like-button-active"):this._likeButton.classList.remove("card__like-button-active"):console.error("Like button not found.")}_handleDeleteButton(){this._handleDeleteClick(this._id)}getView(){return this._element=this._cardElement,this._cardImageEl=this._element.querySelector(".card__image"),this._element.setAttribute("data-id",this._id),this._element.querySelector(".card__title").textContent=this._name,this._cardImageEl.src=this._link,this._cardImageEl.alt=this._name,this._updateLikeStatus(),this._setEventListeners(),this._element}}class s{constructor(e){let{modalSelector:t}=e;this._modalElement=document.querySelector(t),this._closeButton=this._modalElement.querySelector(".modal__close"),this._handleEscapeKey=this._handleEscapeKey.bind(this)}open(){this._modalElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscapeKey)}close(){this._modalElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscapeKey)}_handleEscapeKey(e){"Escape"===e.key&&this.close()}_setEventListeners(){this._modalElement.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&this.close()})),this._closeButton.addEventListener("click",(()=>{this.close()}))}}class r extends s{constructor(e,t){super({modalSelector:e}),this._modalForm=this._modalElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._inputElements=this._modalForm.querySelectorAll(".modal__input")}_getInputValues(){const e={};return this._inputElements.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super._setEventListeners(),this._modalForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}}const n=document.querySelectorAll(".modal__form"),i=document.querySelector("#profile__edit-button-js"),o=(document.forms["profile-edit-form"],document.querySelector("#profile__add-button-js")),a={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible",errorList:"modal__error"},l=document.querySelector("[name='name']"),d=document.querySelector("[name='about']"),c=document.querySelector(".profile__avatar"),h=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getUserInfoAndCards(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse)}createCard(e){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}likeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._checkResponse)}unlikeCard(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._checkResponse)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:this._headers}).then(this._checkResponse)}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._checkResponse)}updateUserAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"a44aa497-1b5c-4737-a030-aa953cdc7c47","Content-Type":"application/json"}}),_=new class{constructor(e,t){let{items:s,renderer:r}=e;this._renderItems=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(e){e.reverse().forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}({items:[],renderer:function(e){const t=k(e);_.addItem(t)}},".cards__list"),u=new r("#profile-edit-modal",(function(e){const t={name:e.name,about:e.about};h.updateUserInfo(t).then((e=>{v.setUserInfo(e),u.close()})).catch((e=>{console.error("Error updating user information:",e)}))}));u.setEventListeners();const m=new r("#add-button-modal",(function(e){const t={name:e.title,link:e.image,likes:[]};h.createCard(t).then((e=>{_.addItem(k(e)),m.close()})).catch((e=>{console.error("Error creating card:",e)}))}));m.setEventListeners();const E=new class extends s{constructor(e){super({modalSelector:e}),this._modalImage=this._modalElement.querySelector(".modal__image"),this._modalImageCaption=this._modalElement.querySelector(".modal__caption")}open(e){this._modalImage.src=e.link,this._modalImage.alt=e.name,this._modalImageCaption.textContent=e.name,super.open()}setEventListeners(){super._setEventListeners(),this._modalImage.addEventListener("submit",(e=>{e.preventDefault()}))}}("#preview-image-modal");E.setEventListeners();const p=new class extends s{constructor(e,t){super({modalSelector:e}),this._modalForm=this._modalElement.querySelector(".modal__form"),this._inputElement=this._modalForm.querySelector("#avatar-link-input"),this._errorElement=this._modalForm.querySelector("#avatar-link-input-error"),this._handleAvatarImageSubmit=t}setEventListeners(){super._setEventListeners(),document.querySelector(".profile__avatar-button").addEventListener("click",(()=>{console.log("Avatar button clicked"),this.open()})),this._modalForm.addEventListener("submit",(e=>{e.preventDefault();const t=this._inputElement.value.trim();t?(this._handleAvatarImageSubmit({avatar:t}),this.close()):console.error("Avatar URL is required.")}))}}("#avatar-edit-modal",(function(e){const t=e.avatar;t?h.updateUserAvatar(t).then((e=>{console.log("User avatar updated successfully:",e),function(e){c.src=e}(t),p.close()})).catch((e=>{console.error("Error updating user avatar:",e)})):console.error("Avatar URL is required.")}));p.setEventListeners();const v=new class{constructor(e){let{nameElementSelector:t,aboutElementSelector:s}=e;this._nameElement=document.querySelector(t),this._aboutElement=document.querySelector(s)}getUserInfo(){return this._userInfo={name:this._nameElement.textContent,about:this._aboutElement.textContent},this._userInfo}setUserInfo(e){let{name:t,about:s}=e;this._nameElement.textContent=t,this._aboutElement.textContent=s}getUserId(){return this._userId}}({nameElementSelector:".profile__title",aboutElementSelector:".profile__description"});function k(e){return new t(e,"#card-template",(()=>{E.open(e)}),S,f,b,v.getUserId()).getView()}function f(e){return h.likeCard(e)}function b(e){return h.unlikeCard(e)}function S(e){h.deleteCard(e).then((()=>{const t=document.querySelector(`[data-id='${e}']`);t&&t.remove()})).catch((e=>{console.error("Error deleting card:",e)}))}document.addEventListener("DOMContentLoaded",(()=>{h.getUserInfoAndCards().then((e=>{let[t,s]=e;s=s.map((e=>({...e,likes:e.likes||[]}))),l.value=t.name||"",d.value=t.about||"",v.setUserInfo(t),_.renderItems(s)})).catch((e=>{console.error("Error fetching user info and cards:",e)}))})),i.addEventListener("click",(()=>{const e=v.getUserInfo();l.value=e.name.trim(),d.value=e.about.trim(),u.open()})),o.addEventListener("click",(()=>{m.open(),L["add-button-form"].resetValidation()})),c.addEventListener("click",(()=>{p.open()}));const L={};(t=>{t.forEach((t=>{const s=new e(a,t);return s.enableValidation(),L[t.getAttribute("id")]=s,L}))})(n)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUV2Q3pILE9BQU9DLElBQ05DLFFBQVFDLE1BQU0sc0NBQXVDRixFQUFJLEdBQ3pELElBbUNObUMsRUFBa0JoRixpQkFBaUIsU0FBUyxLQUMxQyxNQUFNd0ssRUFBY3BELEVBQVNkLGNBQzdCbEIsRUFBVVAsTUFBUTJGLEVBQVl6SixLQUFLMEksT0FDbkNwRSxFQUFXUixNQUFRMkYsRUFBWWhDLE1BQU1pQixPQUVyQ25CLEVBQWF2RSxNQUFNLElBR3JCa0IsRUFBb0JqRixpQkFBaUIsU0FBUyxLQUM1QzJJLEVBQVU1RSxPQUNWMEcsRUFBZSxtQkFBbUJySyxpQkFBaUIsSUFHckRrRixFQUFZdEYsaUJBQWlCLFNBQVMsS0FDcENrSixFQUFnQm5GLE1BQU0sSUE0RXhCLE1BQU0wRyxFQUFpQixDQUFDLEVBQ0UxRixLQUN4QkEsRUFBU2hGLFNBQVMySyxJQUNoQixNQUFNQyxFQUFnQixJQUFJdE4sRUFBY0UsRUFBVW1OLEdBR2xELE9BRkFDLEVBQWN6SyxtQkFDZHVLLEVBQWVDLEVBQUtFLGFBQWEsT0FBU0QsRUFDbkNGLENBQWMsR0FDckIsRUFHSnZLLENBQWlCNkUsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9DYXJkLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Nb2RhbC5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9hcm91bmQtdGhlLXVzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL1NlY3Rpb24uanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL01vZGFsV2l0aEltYWdlLmpzIiwid2VicGFjazovL2Fyb3VuZC10aGUtdXMvLi9zcmMvY29tcG9uZW50cy9Nb2RhbEVkaXRBdmF0YXIuanMiLCJ3ZWJwYWNrOi8vYXJvdW5kLXRoZS11cy8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3RvcihzZXR0aW5ncywgZm9ybUVsZW1lbnQpIHtcbiAgICB0aGlzLl9mb3JtID0gZm9ybUVsZW1lbnQ7XG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IHNldHRpbmdzLmlucHV0U2VsZWN0b3I7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IgPSBzZXR0aW5ncy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBzZXR0aW5ncy5pbnB1dEVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JDbGFzcyA9IHNldHRpbmdzLmVycm9yQ2xhc3M7XG4gICAgdGhpcy5fZXJyb3JMaXN0ID0gc2V0dGluZ3MuZXJyb3JMaXN0O1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMgPSBBcnJheS5mcm9tKFxuICAgICAgdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcbiAgICApO1xuICAgIGlucHV0RWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZTtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfaGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XG4gICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcbiAgICAgIGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICB0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5fZXJyb3JDbGFzcyk7XG4gIH1cblxuICBfY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCkge1xuICAgIGlmICghaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9oYXNJbnZhbGlkSW5wdXQoKSB7XG4gICAgcmV0dXJuIEFycmF5LmZyb20odGhpcy5faW5wdXRFbGVtZW50cykuc29tZShcbiAgICAgIChpbnB1dEVsZW1lbnQpID0+ICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWRcbiAgICApO1xuICB9XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKCkge1xuICAgIGlmICh0aGlzLl9oYXNJbnZhbGlkSW5wdXQoKSkge1xuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoZSkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KTtcbiAgICAgICAgdGhpcy5fdG9nZ2xlQnV0dG9uU3RhdGUoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZW5hYmxlVmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9KTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICB9XG5cbiAgcmVzZXRWYWxpZGF0aW9uKCkge1xuICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgZGF0YSxcbiAgICBjYXJkU2VsZWN0b3IsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDbGljayxcbiAgICBoYW5kbGVMaWtlQ2FyZCxcbiAgICBoYW5kbGVVbmxpa2VDYXJkLFxuICAgIGN1cnJlbnRVc2VySWRcbiAgKSB7XG4gICAgdGhpcy5fbmFtZSA9IGRhdGEubmFtZTtcbiAgICB0aGlzLl9saW5rID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX2lkID0gZGF0YS5faWQ7XG4gICAgdGhpcy5fbGlrZXMgPSBkYXRhLmxpa2VzIHx8IFtdO1xuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrID0gaGFuZGxlSW1hZ2VDbGljaztcbiAgICB0aGlzLl9oYW5kbGVEZWxldGVDbGljayA9IGhhbmRsZURlbGV0ZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VDYXJkID0gaGFuZGxlTGlrZUNhcmQ7XG4gICAgdGhpcy5faGFuZGxlVW5saWtlQ2FyZCA9IGhhbmRsZVVubGlrZUNhcmQ7XG4gICAgdGhpcy5fY3VycmVudFVzZXJJZCA9IGN1cnJlbnRVc2VySWQ7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSB0aGlzLl9nZXRUZW1wbGF0ZSgpO1xuICB9XG5cbiAgLy8gX2dldFRlbXBsYXRlKCkge1xuICAvLyAgIHJldHVybiBkb2N1bWVudFxuICAvLyAgICAgLnF1ZXJ5U2VsZWN0b3IodGhpcy5fY2FyZFNlbGVjdG9yKVxuICAvLyAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gIC8vICAgICAuY2xvbmVOb2RlKHRydWUpO1xuICAvLyAgIHRoaXMuX2xpa2VCdXR0b24gPSB0ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICAvLyB9XG5cbiAgX2dldFRlbXBsYXRlKCkge1xuICAgIGNvbnN0IHRlbXBsYXRlID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uID0gdGVtcGxhdGUucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9kZWxldGVCdXR0b24gPSB0ZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG4gICAgdGhpcy5fbGlrZUNvdW50RWxlbWVudCA9IHRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudFwiKTtcbiAgICByZXR1cm4gdGVtcGxhdGU7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgLy8gdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG5cbiAgICAvLyB0aGlzLl9kZWxldGVCdXR0b24gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgIC8vICAgXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiXG4gICAgLy8gKTtcbiAgICB0aGlzLl9saWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQnV0dG9uKCk7XG4gICAgfSk7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLl9oYW5kbGVEZWxldGVCdXR0b24oKTtcbiAgICB9KTtcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5faGFuZGxlSW1hZ2VDbGljayh0aGlzLl9kYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIF9oYW5kbGVMaWtlQnV0dG9uKCkge1xuICAgIGlmICh0aGlzLl9pc0xpa2VkKCkpIHtcbiAgICAgIHRoaXMuX2hhbmRsZVVubGlrZUNhcmQodGhpcy5faWQpXG4gICAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZERhdGEpID0+IHtcbiAgICAgICAgICB0aGlzLl9saWtlcyA9IHVwZGF0ZWRDYXJkRGF0YS5saWtlcztcbiAgICAgICAgICB0aGlzLl91cGRhdGVMaWtlU3RhdHVzKCk7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgdW5saWtpbmcgY2FyZDogJHtlcnJ9YCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9oYW5kbGVMaWtlQ2FyZCh0aGlzLl9pZClcbiAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkRGF0YSkgPT4ge1xuICAgICAgICAgIHRoaXMuX2xpa2VzID0gdXBkYXRlZENhcmREYXRhLmxpa2VzO1xuICAgICAgICAgIHRoaXMuX3VwZGF0ZUxpa2VTdGF0dXMoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBsaWtpbmcgY2FyZDogJHtlcnJ9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9pc0xpa2VkKCkge1xuICAgIHJldHVybiB0aGlzLl9saWtlcy5zb21lKChsaWtlKSA9PiBsaWtlLl9pZCA9PT0gdGhpcy5fY3VycmVudFVzZXJJZCk7XG4gIH1cblxuICBfdXBkYXRlTGlrZVN0YXR1cygpIHtcbiAgICBjb25zdCBsaWtlQ291bnRFbGVtZW50ID1cbiAgICAgIHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudFwiKTtcbiAgICBpZiAobGlrZUNvdW50RWxlbWVudCkge1xuICAgICAgbGlrZUNvdW50RWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMuX2xpa2VzLmxlbmd0aDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fbGlrZUJ1dHRvbikge1xuICAgICAgaWYgKHRoaXMuX2lzTGlrZWQoKSkge1xuICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbi1hY3RpdmVcIik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMaWtlIGJ1dHRvbiBub3QgZm91bmQuXCIpO1xuICAgIH1cbiAgfVxuXG4gIF9oYW5kbGVEZWxldGVCdXR0b24oKSB7XG4gICAgdGhpcy5faGFuZGxlRGVsZXRlQ2xpY2sodGhpcy5faWQpO1xuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgdGhpcy5fZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWlkXCIsIHRoaXMuX2lkKTtcbiAgICB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIikudGV4dENvbnRlbnQgPSB0aGlzLl9uYW1lO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsLnNyYyA9IHRoaXMuX2xpbms7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl91cGRhdGVMaWtlU3RhdHVzKCk7XG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcih7IG1vZGFsU2VsZWN0b3IgfSkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobW9kYWxTZWxlY3Rvcik7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XG4gICAgdGhpcy5faGFuZGxlRXNjYXBlS2V5ID0gdGhpcy5faGFuZGxlRXNjYXBlS2V5LmJpbmQodGhpcyk7XG4gIH1cblxuICBvcGVuKCkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY2FwZUtleSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLl9tb2RhbEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NhcGVLZXkpO1xuICB9XG5cbiAgX2hhbmRsZUVzY2FwZUtleShlKSB7XG4gICAgaWYgKGUua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHRoaXMuX21vZGFsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGlmIChlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbF9vcGVuZWRcIikpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMuX2Nsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBNb2RhbCBmcm9tIFwiLi9Nb2RhbC5qc1wiO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbFdpdGhGb3JtIGV4dGVuZHMgTW9kYWwge1xuICBjb25zdHJ1Y3Rvcihtb2RhbFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgc3VwZXIoeyBtb2RhbFNlbGVjdG9yIH0pO1xuICAgIHRoaXMuX21vZGFsRm9ybSA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xuICAgIHRoaXMuX2lucHV0RWxlbWVudHMgPSB0aGlzLl9tb2RhbEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIik7XG4gIH1cblxuICBfZ2V0SW5wdXRWYWx1ZXMoKSB7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGlucHV0VmFsdWVzO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fbW9kYWxGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgfSk7XG4gIH1cbn1cbiIsImV4cG9ydCBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxfX2Zvcm1cIik7XG5cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGVfX2VkaXQtYnV0dG9uLWpzXCJcbik7XG5cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcInByb2ZpbGUtZWRpdC1mb3JtXCJdO1xuXG5leHBvcnQgY29uc3QgYWRkY3JlYXRlQ2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGVfX2FkZC1idXR0b24tanNcIlxuKTtcblxuZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbiAgZXJyb3JMaXN0OiBcIm1vZGFsX19lcnJvclwiLFxufTtcblxuZXhwb3J0IGNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJbbmFtZT0nbmFtZSddXCIpO1xuZXhwb3J0IGNvbnN0IGFib3V0SW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW25hbWU9J2Fib3V0J11cIik7XG5cbmV4cG9ydCBjb25zdCBhdmF0YXJJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xuIiwiLy8gSU1QT1JUU1xuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBNb2RhbFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IE1vZGFsV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvTW9kYWxXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IE1vZGFsRWRpdEF2YXRhciBmcm9tIFwiLi4vY29tcG9uZW50cy9Nb2RhbEVkaXRBdmF0YXIuanNcIjtcbmltcG9ydCBVc2VySW5mbyBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mby5qc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGkuanNcIjtcbmltcG9ydCB7XG4gIGZvcm1MaXN0LFxuICBzZXR0aW5ncyxcbiAgcHJvZmlsZUVkaXRCdXR0b24sXG4gIGFkZGNyZWF0ZUNhcmRCdXR0b24sXG4gIG5hbWVJbnB1dCxcbiAgYWJvdXRJbnB1dCxcbiAgYXZhdGFySW1hZ2UsXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcblxuLy8gQVBJXG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcImE0NGFhNDk3LTFiNWMtNDczNy1hMDMwLWFhOTUzY2RjN2M0N1wiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vIFNFQ1RJT04gQ0xBU1NcblxuY29uc3QgY2FyZHNTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gIHtcbiAgICBpdGVtczogW10sXG4gICAgcmVuZGVyZXI6IHJlbmRlckNhcmQsXG4gIH0sXG4gIFwiLmNhcmRzX19saXN0XCJcbik7XG5cbi8vIE1PREFMU1xuXG5jb25zdCBwcm9maWxlTW9kYWwgPSBuZXcgTW9kYWxXaXRoRm9ybShcbiAgXCIjcHJvZmlsZS1lZGl0LW1vZGFsXCIsXG4gIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0XG4pO1xucHJvZmlsZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGNhcmRNb2RhbCA9IG5ldyBNb2RhbFdpdGhGb3JtKFwiI2FkZC1idXR0b24tbW9kYWxcIiwgaGFuZGxlQWRkQ2FyZFN1Ym1pdCk7XG5jYXJkTW9kYWwuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgcHJldmlld0ltYWdlTW9kYWwgPSBuZXcgTW9kYWxXaXRoSW1hZ2UoXCIjcHJldmlldy1pbWFnZS1tb2RhbFwiKTtcbnByZXZpZXdJbWFnZU1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGF2YXRhckVkaXRNb2RhbCA9IG5ldyBNb2RhbEVkaXRBdmF0YXIoXG4gIFwiI2F2YXRhci1lZGl0LW1vZGFsXCIsXG4gIGhhbmRsZUF2YXRhckltYWdlU3VibWl0XG4pO1xuYXZhdGFyRWRpdE1vZGFsLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbi8vIFVTRVIgSU5GT1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWVFbGVtZW50U2VsZWN0b3I6IFwiLnByb2ZpbGVfX3RpdGxlXCIsXG4gIGFib3V0RWxlbWVudFNlbGVjdG9yOiBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiLFxufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsICgpID0+IHtcbiAgYXBpXG4gICAgLmdldFVzZXJJbmZvQW5kQ2FyZHMoKVxuICAgIC50aGVuKChbdXNlckRhdGEsIGluaXRpYWxDYXJkc10pID0+IHtcbiAgICAgIGluaXRpYWxDYXJkcyA9IGluaXRpYWxDYXJkcy5tYXAoKGNhcmQpID0+ICh7XG4gICAgICAgIC4uLmNhcmQsXG4gICAgICAgIGxpa2VzOiBjYXJkLmxpa2VzIHx8IFtdLFxuICAgICAgfSkpO1xuICAgICAgbmFtZUlucHV0LnZhbHVlID0gdXNlckRhdGEubmFtZSB8fCBcIlwiO1xuICAgICAgYWJvdXRJbnB1dC52YWx1ZSA9IHVzZXJEYXRhLmFib3V0IHx8IFwiXCI7XG4gICAgICB1c2VySW5mby5zZXRVc2VySW5mbyh1c2VyRGF0YSk7XG4gICAgICBjYXJkc1NlY3Rpb24ucmVuZGVySXRlbXMoaW5pdGlhbENhcmRzKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgdXNlciBpbmZvIGFuZCBjYXJkczpcIiwgZXJyKTtcbiAgICB9KTtcbn0pO1xuXG4vLyBGVU5DVElPTlNcblxuZnVuY3Rpb24gY3JlYXRlQ2FyZChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gbmV3IENhcmQoXG4gICAgZGF0YSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgKCkgPT4ge1xuICAgICAgcHJldmlld0ltYWdlTW9kYWwub3BlbihkYXRhKTtcbiAgICB9LFxuICAgIGhhbmRsZURlbGV0ZUNhcmQsXG4gICAgaGFuZGxlTGlrZUNhcmQsXG4gICAgaGFuZGxlVW5saWtlQ2FyZCxcbiAgICB1c2VySW5mby5nZXRVc2VySWQoKVxuICApO1xuICByZXR1cm4gY2FyZEVsZW1lbnQuZ2V0VmlldygpO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGNhcmREYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChjYXJkRGF0YSk7XG4gIGNhcmRzU2VjdGlvbi5hZGRJdGVtKGNhcmRFbGVtZW50KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlTGlrZUNhcmQoY2FyZElkKSB7XG4gIHJldHVybiBhcGkubGlrZUNhcmQoY2FyZElkKTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlVW5saWtlQ2FyZChjYXJkSWQpIHtcbiAgcmV0dXJuIGFwaS51bmxpa2VDYXJkKGNhcmRJZCk7XG59XG5cbi8vIEVWRU5UIExJU1RFTkVSU1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjb25zdCBjdXJyZW50VXNlciA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIG5hbWVJbnB1dC52YWx1ZSA9IGN1cnJlbnRVc2VyLm5hbWUudHJpbSgpO1xuICBhYm91dElucHV0LnZhbHVlID0gY3VycmVudFVzZXIuYWJvdXQudHJpbSgpO1xuXG4gIHByb2ZpbGVNb2RhbC5vcGVuKCk7XG59KTtcblxuYWRkY3JlYXRlQ2FyZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjYXJkTW9kYWwub3BlbigpO1xuICBmb3JtVmFsaWRhdG9yc1tcImFkZC1idXR0b24tZm9ybVwiXS5yZXNldFZhbGlkYXRpb24oKTtcbn0pO1xuXG5hdmF0YXJJbWFnZS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBhdmF0YXJFZGl0TW9kYWwub3BlbigpO1xufSk7XG5cbi8vIEVWRU5UIEhBTkRMRVJTXG5cbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVFZGl0U3VibWl0KGlucHV0VmFsdWVzKSB7XG4gIGNvbnN0IHVwZGF0ZWRVc2VySW5mbyA9IHtcbiAgICBuYW1lOiBpbnB1dFZhbHVlcy5uYW1lLFxuICAgIGFib3V0OiBpbnB1dFZhbHVlcy5hYm91dCxcbiAgfTtcblxuICBhcGlcbiAgICAudXBkYXRlVXNlckluZm8odXBkYXRlZFVzZXJJbmZvKVxuICAgIC50aGVuKCh1cGRhdGVkRGF0YSkgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8odXBkYXRlZERhdGEpO1xuICAgICAgcHJvZmlsZU1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVwZGF0aW5nIHVzZXIgaW5mb3JtYXRpb246XCIsIGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoaW5wdXRWYWx1ZXMpIHtcbiAgY29uc3QgbmFtZSA9IGlucHV0VmFsdWVzLnRpdGxlO1xuICBjb25zdCBsaW5rID0gaW5wdXRWYWx1ZXMuaW1hZ2U7XG4gIGNvbnN0IGRhdGEgPSB7IG5hbWUsIGxpbmssIGxpa2VzOiBbXSB9O1xuXG4gIGFwaVxuICAgIC5jcmVhdGVDYXJkKGRhdGEpXG4gICAgLnRoZW4oKG5ld0NhcmQpID0+IHtcbiAgICAgIGNhcmRzU2VjdGlvbi5hZGRJdGVtKGNyZWF0ZUNhcmQobmV3Q2FyZCkpO1xuICAgICAgY2FyZE1vZGFsLmNsb3NlKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGNyZWF0aW5nIGNhcmQ6XCIsIGVycik7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmQoY2FyZElkKSB7XG4gIGFwaVxuICAgIC5kZWxldGVDYXJkKGNhcmRJZClcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjb25zdCBjYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYFtkYXRhLWlkPScke2NhcmRJZH0nXWApO1xuICAgICAgaWYgKGNhcmRFbGVtZW50KSB7XG4gICAgICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkOlwiLCBlcnIpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJJbWFnZVN1Ym1pdChpbnB1dFZhbHVlcykge1xuICBjb25zdCBhdmF0YXJVcmwgPSBpbnB1dFZhbHVlcy5hdmF0YXI7XG4gIGlmIChhdmF0YXJVcmwpIHtcbiAgICBhcGlcbiAgICAgIC51cGRhdGVVc2VyQXZhdGFyKGF2YXRhclVybClcbiAgICAgIC50aGVuKCh1cGRhdGVkRGF0YSkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgYXZhdGFyIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5OlwiLCB1cGRhdGVkRGF0YSk7XG4gICAgICAgIHVwZGF0ZUF2YXRhclVJKGF2YXRhclVybCk7XG4gICAgICAgIGF2YXRhckVkaXRNb2RhbC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyIGF2YXRhcjpcIiwgZXJyKTtcbiAgICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJBdmF0YXIgVVJMIGlzIHJlcXVpcmVkLlwiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVBdmF0YXJVSShhdmF0YXJVcmwpIHtcbiAgYXZhdGFySW1hZ2Uuc3JjID0gYXZhdGFyVXJsO1xufVxuXG4vLyBWQUxJREFUSU9OXG5cbmNvbnN0IGZvcm1WYWxpZGF0b3JzID0ge307XG5jb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGZvcm1MaXN0KSA9PiB7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm0pID0+IHtcbiAgICBjb25zdCBmb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3Ioc2V0dGluZ3MsIGZvcm0pO1xuICAgIGZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuICAgIGZvcm1WYWxpZGF0b3JzW2Zvcm0uZ2V0QXR0cmlidXRlKFwiaWRcIildID0gZm9ybVZhbGlkYXRvcjtcbiAgICByZXR1cm4gZm9ybVZhbGlkYXRvcnM7XG4gIH0pO1xufTtcblxuZW5hYmxlVmFsaWRhdGlvbihmb3JtTGlzdCk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBBcGkge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IG9wdGlvbnMuYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gb3B0aW9ucy5oZWFkZXJzO1xuICB9XG5cbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfVxuICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvQW5kQ2FyZHMoKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcbiAgfVxuXG4gIGdldEluaXRpYWxDYXJkcygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBjcmVhdGVDYXJkKGNhcmREYXRhKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShjYXJkRGF0YSksXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7Y2FyZElkfWAsIHtcbiAgICAgIG1ldGhvZDogXCJERUxFVEVcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKTtcbiAgfVxuXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICB1bmxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSk7XG4gIH1cblxuICB1cGRhdGVVc2VySW5mbyh1c2VySW5mbykge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHVzZXJJbmZvKSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgdXBkYXRlVXNlckF2YXRhcihhdmF0YXJVcmwpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXI6IGF2YXRhclVybCB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpO1xuICB9XG59XG5cbi8vIGNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuLy8gICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4vLyAgIGhlYWRlcnM6IHtcbi8vICAgICBhdXRob3JpemF0aW9uOiBcImE0NGFhNDk3LTFiNWMtNDczNy1hMDMwLWFhOTUzY2RjN2M0N1wiLFxuLy8gICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuLy8gICB9LFxuLy8gfSk7XG5cbi8vIGFwaVxuLy8gICAuZ2V0SW5pdGlhbENhcmRzKClcbi8vICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKHJlc3VsdCk7XG4vLyAgIH0pXG4vLyAgIC5jYXRjaCgoZXJyKSA9PiB7XG4vLyAgICAgY29uc29sZS5sb2coZXJyKTtcbi8vICAgfSk7XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY29udGFpbmVyU2VsZWN0b3IpIHtcbiAgICB0aGlzLl9yZW5kZXJJdGVtcyA9IGl0ZW1zO1xuICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgdGhpcy5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihjb250YWluZXJTZWxlY3Rvcik7XG4gIH1cblxuICByZW5kZXJJdGVtcyhpdGVtcykge1xuICAgIGl0ZW1zLnJldmVyc2UoKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oaXRlbSkge1xuICAgIHRoaXMuX2NvbnRhaW5lci5wcmVwZW5kKGl0ZW0pO1xuICB9XG59XG4iLCJpbXBvcnQgTW9kYWwgZnJvbSBcIi4vTW9kYWwuanNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTW9kYWxXaXRoSW1hZ2UgZXh0ZW5kcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG1vZGFsU2VsZWN0b3IpIHtcbiAgICBzdXBlcih7IG1vZGFsU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fbW9kYWxJbWFnZSA9IHRoaXMuX21vZGFsRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbiAgICB0aGlzLl9tb2RhbEltYWdlQ2FwdGlvbiA9XG4gICAgICB0aGlzLl9tb2RhbEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcbiAgfVxuXG4gIG9wZW4oZGF0YSkge1xuICAgIHRoaXMuX21vZGFsSW1hZ2Uuc3JjID0gZGF0YS5saW5rO1xuICAgIHRoaXMuX21vZGFsSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX21vZGFsSW1hZ2VDYXB0aW9uLnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX21vZGFsSW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgLy8gdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9nZXRJbnB1dFZhbHVlcygpKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IE1vZGFsIGZyb20gXCIuL01vZGFsLmpzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsRWRpdEF2YXRhciBleHRlbmRzIE1vZGFsIHtcbiAgY29uc3RydWN0b3IobW9kYWxTZWxlY3RvciwgaGFuZGxlQXZhdGFySW1hZ2VTdWJtaXQpIHtcbiAgICBzdXBlcih7IG1vZGFsU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fbW9kYWxGb3JtID0gdGhpcy5fbW9kYWxFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faW5wdXRFbGVtZW50ID0gdGhpcy5fbW9kYWxGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWxpbmstaW5wdXRcIik7XG4gICAgdGhpcy5fZXJyb3JFbGVtZW50ID0gdGhpcy5fbW9kYWxGb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIiNhdmF0YXItbGluay1pbnB1dC1lcnJvclwiXG4gICAgKTtcbiAgICB0aGlzLl9oYW5kbGVBdmF0YXJJbWFnZVN1Ym1pdCA9IGhhbmRsZUF2YXRhckltYWdlU3VibWl0O1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuX3NldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgY29uc3QgYXZhdGFyQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnV0dG9uXCIpO1xuICAgIGF2YXRhckJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJBdmF0YXIgYnV0dG9uIGNsaWNrZWRcIik7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9KTtcblxuICAgIHRoaXMuX21vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IGF2YXRhclVybCA9IHRoaXMuX2lucHV0RWxlbWVudC52YWx1ZS50cmltKCk7XG4gICAgICBpZiAoYXZhdGFyVXJsKSB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUF2YXRhckltYWdlU3VibWl0KHsgYXZhdGFyOiBhdmF0YXJVcmwgfSk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdmF0YXIgVVJMIGlzIHJlcXVpcmVkLlwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IG5hbWVFbGVtZW50U2VsZWN0b3IsIGFib3V0RWxlbWVudFNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9uYW1lRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IobmFtZUVsZW1lbnRTZWxlY3Rvcik7XG4gICAgdGhpcy5fYWJvdXRFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihhYm91dEVsZW1lbnRTZWxlY3Rvcik7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICB0aGlzLl91c2VySW5mbyA9IHtcbiAgICAgIG5hbWU6IHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX2Fib3V0RWxlbWVudC50ZXh0Q29udGVudCxcbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMuX3VzZXJJbmZvO1xuICB9XG5cbiAgc2V0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2Fib3V0RWxlbWVudC50ZXh0Q29udGVudCA9IGFib3V0O1xuICB9XG4gIGdldFVzZXJJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fdXNlcklkO1xuICB9XG59XG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsInRoaXMiLCJfZm9ybSIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9lcnJvckxpc3QiLCJlcnJvckxpc3QiLCJfaW5wdXRFbGVtZW50cyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwicXVlcnlTZWxlY3RvciIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsIl9lcnJvck1lc3NhZ2VFbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJ0ZXh0Q29udGVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwiX2hpZGVJbnB1dEVycm9yIiwicmVtb3ZlIiwiX2NoZWNrSW5wdXRWYWxpZGl0eSIsInZhbGlkaXR5IiwidmFsaWQiLCJfaGFzSW52YWxpZElucHV0Iiwic29tZSIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImRpc2FibGVkIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZW5hYmxlVmFsaWRhdGlvbiIsInByZXZlbnREZWZhdWx0IiwicmVzZXRWYWxpZGF0aW9uIiwicmVzZXQiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVEZWxldGVDbGljayIsImhhbmRsZUxpa2VDYXJkIiwiaGFuZGxlVW5saWtlQ2FyZCIsImN1cnJlbnRVc2VySWQiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfbGlrZXMiLCJsaWtlcyIsIl9jYXJkU2VsZWN0b3IiLCJfZGF0YSIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZURlbGV0ZUNsaWNrIiwiX2hhbmRsZUxpa2VDYXJkIiwiX2hhbmRsZVVubGlrZUNhcmQiLCJfY3VycmVudFVzZXJJZCIsIl9jYXJkRWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsInRlbXBsYXRlIiwiZG9jdW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiX2xpa2VCdXR0b24iLCJfZGVsZXRlQnV0dG9uIiwiX2xpa2VDb3VudEVsZW1lbnQiLCJfaGFuZGxlTGlrZUJ1dHRvbiIsIl9oYW5kbGVEZWxldGVCdXR0b24iLCJfY2FyZEltYWdlRWwiLCJfaXNMaWtlZCIsInRoZW4iLCJ1cGRhdGVkQ2FyZERhdGEiLCJfdXBkYXRlTGlrZVN0YXR1cyIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwibGlrZSIsImxpa2VDb3VudEVsZW1lbnQiLCJsZW5ndGgiLCJnZXRWaWV3IiwiX2VsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJzcmMiLCJhbHQiLCJNb2RhbCIsIl9yZWYiLCJtb2RhbFNlbGVjdG9yIiwiX21vZGFsRWxlbWVudCIsIl9jbG9zZUJ1dHRvbiIsIl9oYW5kbGVFc2NhcGVLZXkiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInRhcmdldCIsImNvbnRhaW5zIiwiTW9kYWxXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9tb2RhbEZvcm0iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsIl9nZXRJbnB1dFZhbHVlcyIsImlucHV0VmFsdWVzIiwiaW5wdXQiLCJ2YWx1ZSIsInNldEV2ZW50TGlzdGVuZXJzIiwiZm9ybUxpc3QiLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZGNyZWF0ZUNhcmRCdXR0b24iLCJmb3JtcyIsImZvcm1TZWxlY3RvciIsIm5hbWVJbnB1dCIsImFib3V0SW5wdXQiLCJhdmF0YXJJbWFnZSIsImFwaSIsIm9wdGlvbnMiLCJfYmFzZVVybCIsImJhc2VVcmwiLCJfaGVhZGVycyIsImhlYWRlcnMiLCJfY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRVc2VySW5mb0FuZENhcmRzIiwiYWxsIiwiZ2V0VXNlckluZm8iLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsImNyZWF0ZUNhcmQiLCJjYXJkRGF0YSIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZGVsZXRlQ2FyZCIsImNhcmRJZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsInVwZGF0ZVVzZXJJbmZvIiwidXNlckluZm8iLCJ1cGRhdGVVc2VyQXZhdGFyIiwiYXZhdGFyVXJsIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsImNhcmRzU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9yZW5kZXJJdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsInJldmVyc2UiLCJpdGVtIiwiYWRkSXRlbSIsInByZXBlbmQiLCJjYXJkRWxlbWVudCIsInByb2ZpbGVNb2RhbCIsInVwZGF0ZWRVc2VySW5mbyIsImFib3V0IiwidXBkYXRlZERhdGEiLCJzZXRVc2VySW5mbyIsImNhcmRNb2RhbCIsInRpdGxlIiwiaW1hZ2UiLCJuZXdDYXJkIiwicHJldmlld0ltYWdlTW9kYWwiLCJfbW9kYWxJbWFnZSIsIl9tb2RhbEltYWdlQ2FwdGlvbiIsImF2YXRhckVkaXRNb2RhbCIsImhhbmRsZUF2YXRhckltYWdlU3VibWl0IiwiX2lucHV0RWxlbWVudCIsIl9lcnJvckVsZW1lbnQiLCJfaGFuZGxlQXZhdGFySW1hZ2VTdWJtaXQiLCJsb2ciLCJldmVudCIsInRyaW0iLCJ1cGRhdGVBdmF0YXJVSSIsIm5hbWVFbGVtZW50U2VsZWN0b3IiLCJhYm91dEVsZW1lbnRTZWxlY3RvciIsIl9uYW1lRWxlbWVudCIsIl9hYm91dEVsZW1lbnQiLCJfdXNlckluZm8iLCJfcmVmMiIsImdldFVzZXJJZCIsIl91c2VySWQiLCJoYW5kbGVEZWxldGVDYXJkIiwidXNlckRhdGEiLCJpbml0aWFsQ2FyZHMiLCJtYXAiLCJjYXJkIiwiY3VycmVudFVzZXIiLCJmb3JtVmFsaWRhdG9ycyIsImZvcm0iLCJmb3JtVmFsaWRhdG9yIiwiZ2V0QXR0cmlidXRlIl0sInNvdXJjZVJvb3QiOiIifQ==